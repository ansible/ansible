#!/usr/bin/python
# -*- coding: utf-8 -*-
# Copyright 2019 Red Hat
# GNU General Public License v3.0+
# (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

#############################################
#                WARNING                    #
#############################################
#
# This file is auto generated by the resource
#   module builder playbook.
#
# Do not edit this file manually.
#
# Changes to this file will be over written
#   by the resource module builder.
#
# Changes should be made in the model used to
#   generate this file or in the resource module
#   builder template.
#
#############################################

"""
The module file for exos_guest_virtual_machines
"""

from __future__ import absolute_import, division, print_function
__metaclass__ = type

ANSIBLE_METADATA = {
    'metadata_version': '1.1',
    'status': ['preview'],
    'supported_by': 'community'
}

DOCUMENTATION = """
---
module: exos_guest_virtual_machines
version_added: "2.10"
short_description:  Manage guest virtual machines on EXOS devices.
description:
  - This module can be used to create guest Virtual machines on EXOS network devices
  - Manages operational state such as start, stop and restart
  - Updates its components such as CPUs, memory, virtual ports, disks etc.
  - Deletes a guest virtual machine with all its associated components.
author: Jayalakshmi Viswanathan (@jayalakshmiV)
notes:
  - Tested against EXOS 30.5
  - This module works with connection C(httpapi).
    See L(EXOS Platform Options,../network/user_guide/platform_exos.html)
options:
  config:
    description: A dictionary of Virtual machine configuration options
    type: list
    elements: dict
    suboptions:
      name:
        description:
          - Name of the virtual machine
        type: str
        required: True
      image:
        description:
          - Name and location of the image on the switch to be installed
        type: str
      num_cores:
        description:
          - Number of CPU cores assigned to the virtual machine
        type: int
      memory_size:
        description:
          - Memory size in Megabytes assigned to the virtual machine
        type: int
      virtual_ports:
        description:
          - Virtual port to be used by the virtual machine.
          - Only local Insight ports can be assigned as a dedicated port (type - vtd) or a virtual interface (type - sriov).
          - An Insight port assigned as a dedicated port to a VM cannot be used to define a virtual interface for any VM or vice versa.
          - An Insight port can have maximum of 16 active virtual interfaces associated with it at a time.
        type: list
        suboptions:
          name:
            description:
              - Name of the virtual port interface
            type: str
            required: True
          port:
            description:
              - Port associated with the virtual port
            type: str
          vlan_id:
            description:
              - Vlan to which the virtual port is to be attached
            type: int
          type:
            description:
              - Virtual port connect type.
            type: str
            choices:
              - vtd
              - sriov
              - bridge
            required: True
      vnc:
        description:
          - VNC configuration for the virtual machine.
        type: dict
        suboptions:
          enabled:
            description:
              - Enable/disable VNC port access for the virtual machine
            type: bool
            default: False
          port:
            description:
              - VNC port number to be assigned to the Virtual machine. Possible range is 5900 to 5915
            type: int
      auto_start:
        description:
          - Auto-start virtual machine on boot
        type: bool
        default: False
      operational_state:
        description:
          - State the virtual machine should be left in
        type: str
        choices:
          - started
          - stopped
          - restarted
      forceful:
        description:
          - Forcefully stop/restart the virtual machine. Used with stop and restart operational_state.
        type: bool
        default: False
  state:
    description:
      - The state the configuration should be left in
    type: str
    choices:
      - merged
      - replaced
      - overridden
      - deleted
    default: merged
"""
EXAMPLES = """
# Using deleted

# Before state:
# -------------
# path: /rest/restconf/data/extreme-virtual-service:virtual-services-config/
# method: GET
# data:
# {
#   "extreme-virtual-service:virtual-services-config": {
#     "virtual-service-config": [
#       {
#         "enable": "false",
#         "memory-size": 1024,
#         "name": "ova_new",
#         "num-cores": 2,
#         "vnc-port": 5901,
#         "vports": {
#           "vport": [
#             {
#               "connect-type": "BRIDGE",
#               "name": "mgmt",
#               "port": "mgmt"
#             },
#             {
#               "connect-type": "VTD",
#               "name": "57",
#               "port": "57"
#             },
#             {
#               "connect-type": "SRIOV",
#               "name": "VF1-58",
#               "port": "58"
#             }
#           ]
#         }
#       },
#       {
#         "enable": "false",
#         "memory-size": 4096,
#         "name": "vm_1",
#         "num-cores": 1,
#         "vnc-port": 0
#       }
#     ]
#   }
# }

- name: Delete the given Virtual machine
  exos_guest_virtual_machines:
    config:
      - name: "vm_1"
    state: deleted

# Module Execution Results:
# -------------------------
#
# "before": [
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 1024,
#         "name": "ova_new",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": true,
#             "port": 5901
#         },
#         "virtual_ports": [
#             {
#                 "type": "BRIDGE",
#                 "name": "mgmt",
#                 "port": "mgmt",
#                 "vlan": null
#             },
#             {
#                 "type": "VTD",
#                 "name": "57",
#                 "port": "57",
#                 "vlan": null
#             },
#             {
#                 "type": "SRIOV",
#                 "name": "VF1-58",
#                 "port": "58",
#                 "vlan": null
#             }
#         ]
#     },
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 4096,
#         "name": "vm_1",
#         "num_cores": 1,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": false,
#             "port": null
#         },
#         "virtual_ports": null
#     }
# ],
#
# "requests": [
#     {
#        "data": {
#          "extreme-virtual-service:input": {
#            "name": "vm_1"
#          }
#        }
#        "method": "POST",
#        "path": "rest/restconf/operations/extreme-virtual-service:uninstall"
#     }
# ],
#
# "after": [
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 1024,
#         "name": "ova_new",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": true,
#             "port": 5901
#         },
#         "virtual_ports": [
#             {
#                 "type": "BRIDGE",
#                 "name": "mgmt",
#                 "port": "mgmt",
#                 "vlan": null
#             },
#             {
#                 "type": "VTD",
#                 "name": "57",
#                 "port": "57",
#                 "vlan": null
#             },
#             {
#                 "type": "SRIOV",
#                 "name": "VF1-58",
#                 "port": "58",
#                 "vlan": null
#             }
#         ]
#     }
# ]
#
# After state:
# -------------
# path: /rest/restconf/data/extreme-virtual-service:virtual-services-config/
# method: GET
# data:
# {
#   "extreme-virtual-service:virtual-services-config": {
#     "virtual-service-config": [
#       {
#         "enable": "false",
#         "memory-size": 1024,
#         "name": "ova_new",
#         "num-cores": 2,
#         "vnc-port": 5901,
#         "vports": {
#           "vport": [
#             {
#               "connect-type": "BRIDGE",
#               "name": "mgmt",
#               "port": "mgmt"
#             },
#             {
#               "connect-type": "VTD",
#               "name": "57",
#               "port": "57"
#             },
#             {
#               "connect-type": "SRIOV",
#               "name": "VF1-58",
#               "port": "58"
#             }
#           ]
#         }
#       }
#     ]
#   }
# }


# Using deleted without any config passed
#"(NOTE: This will delete all configured virtual machines)"

# Before state:
# -------------
# path: /rest/restconf/data/extreme-virtual-service:virtual-services-config/
# method: GET
# data:
# {
#   "extreme-virtual-service:virtual-services-config": {
#     "virtual-service-config": [
#       {
#         "enable": "false",
#         "memory-size": 1024,
#         "name": "ova_new",
#         "num-cores": 2,
#         "vnc-port": 5901,
#         "vports": {
#           "vport": [
#             {
#               "connect-type": "BRIDGE",
#               "name": "mgmt",
#               "port": "mgmt"
#             },
#             {
#               "connect-type": "VTD",
#               "name": "57",
#               "port": "57"
#             },
#             {
#               "connect-type": "SRIOV",
#               "name": "VF1-58",
#               "port": "58"
#             }
#           ]
#         }
#       },
#       {
#         "enable": "false",
#         "memory-size": 4096,
#         "name": "vm_1",
#         "num-cores": 1,
#         "vnc-port": 0
#       }
#     ]
#   }
# }

- name: Delete the given Virtual machines
  exos_virtual_machines:
    state: deleted

# Module Execution Results:
# -------------------------
#
# "before": [
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 1024,
#         "name": "ova_new",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": true,
#             "port": 5901
#         },
#         "virtual_ports": [
#             {
#                 "type": "BRIDGE",
#                 "name": "mgmt",
#                 "port": "mgmt",
#                 "vlan": null
#             },
#             {
#                 "type": "VTD",
#                 "name": "57",
#                 "port": "57",
#                 "vlan": null
#             },
#             {
#                 "type": "SRIOV",
#                 "name": "VF1-58",
#                 "port": "58",
#                 "vlan": null
#             }
#         ]
#     },
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 4096,
#         "name": "vm_1",
#         "num_cores": 1,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": false,
#             "port": null
#         },
#         "virtual_ports": null
#     }
# ],
#
# "requests": [
#     {
#        "data": {
#          "extreme-virtual-service:input": {
#            "name": "vm_1"
#          }
#        }
#        "method": "POST",
#        "path": "rest/restconf/operations/extreme-virtual-service:uninstall"
#     },
#     {
#        "data": {
#          "extreme-virtual-service:input": {
#            "name": "ova_new"
#          }
#        }
#        "method": "POST",
#        "path": "rest/restconf/operations/extreme-virtual-service:uninstall"
#     }
# ],
#
# "after": []
#
# After state:
# -------------
# path: /rest/restconf/data/extreme-virtual-service:virtual-services-config/
# method: GET
# data:
# {
#   "extreme-virtual-service:virtual-services-config": {
#     "virtual-service-config": []
#   }
# }


# Using merged

# Before state:
# -------------
# path: /rest/restconf/data/extreme-virtual-service:virtual-services-config/
# method: GET
# data:
# {
#   "extreme-virtual-service:virtual-services-config": {
#     "virtual-service-config": [
#       {
#         "enable": "false",
#         "memory-size": 1024,
#         "name": "ova_new",
#         "num-cores": 2,
#         "vnc-port": 5901,
#         "vports": {
#           "vport": [
#             {
#               "connect-type": "BRIDGE",
#               "name": "mgmt",
#               "port": "mgmt"
#             },
#             {
#               "connect-type": "VTD",
#               "name": "57",
#               "port": "57"
#             },
#             {
#               "connect-type": "SRIOV",
#               "name": "VF1-58",
#               "port": "58"
#             }
#           ]
#         }
#       },
#       {
#         "enable": "false",
#         "memory-size": 4096,
#         "name": "vm_1",
#         "num-cores": 1,
#         "vnc-port": 0
#       }
#     ]
#   }
# }

- name: Merge provided configuration with the device configuration
  exos_guest_virtual_machines:
    config:
      - name: "vm_2"
        image: "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2"
      - name: "vm_1"
        virtual_ports:
          type: "SRIOV"
          name: "VF1-57"
          port: "57"
        vnc:
          enabled: True
          port: 5902
    state: merged

# Module Execution Results:
# -------------------------
#
# "before": [
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 1024,
#         "name": "ova_new",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": True,
#             "port": 5901
#         },
#         "virtual_ports": [
#             {
#                 "type": "BRIDGE",
#                 "name": "mgmt",
#                 "port": "mgmt",
#                 "vlan": null
#             },
#             {
#                 "type": "VTD",
#                 "name": "57",
#                 "port": "57",
#                 "vlan": null
#             },
#             {
#                 "type": "SRIOV",
#                 "name": "VF1-58",
#                 "port": "58",
#                 "vlan": null
#             }
#         ]
#     },
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 4096,
#         "name": "vm_1",
#         "num_cores": 1,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": False,
#             "port": null
#         },
#         "virtual_ports": null
#     }
# ],
#
# "requests": [
#     {
#        "data": {
#          "extreme-virtual-service:input": {
#            "name": "vm_2"
#          }
#        }
#        "method": "POST",
#        "path": "rest/restconf/operations/extreme-virtual-service:install"
#     },
#     {
#        "data": {
#          "extreme-virtual-service:vport": [
#              {
#                "name": "VF1-57",
#                "connect-type": "SRIOV",
#                "port": "57"
#              }
#          ]
#        }
#        "method": "POST",
#        "path": "rest/restconf/data/extreme-virtual-service:virtual-services-config/virtual-service-config=vm_1/vports"
#     }
#     {
#        "data": {
#          "extreme-virtual-service:virtual-service-config": [
#              {
#                "vnc-port": 5902
#              }
#          ]
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/extreme-virtual-service:virtual-services-config/virtual-service-config=vm_1"
#     }
# ],
#
# "after": [
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 1024,
#         "name": "ova_new",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": True,
#             "port": 5901
#         },
#         "virtual_ports": [
#             {
#                 "type": "BRIDGE",
#                 "name": "mgmt",
#                 "port": "mgmt",
#                 "vlan": null
#             },
#             {
#                 "type": "VTD",
#                 "name": "57",
#                 "port": "57",
#                 "vlan": null
#             },
#             {
#                 "type": "SRIOV",
#                 "name": "VF1-58",
#                 "port": "58",
#                 "vlan": null
#             }
#         ]
#     },
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 4096,
#         "name": "vm_1",
#         "num_cores": 1,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": True,
#             "port": 5902
#         },
#         "virtual_ports": [
#             {
#                 "type": "SRIOV",
#                 "name": "VF1-57",
#                 "port": "57",
#                 "vlan": null
#             }
#         ]
#     },
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 4096,
#         "name": "vm_2",
#         "num_cores": 1,
#         "operational_state": "stopped",
#         "vnc": {
#             "enabled": False,
#             "port": null
#         },
#         "virtual_ports": null
#     }
# ]
#
# After state:
# -------------
# path: /rest/restconf/data/extreme-virtual-service:virtual-services-config/
# method: GET
# data:
# {
#   "extreme-virtual-service:virtual-services-config": {
#     "virtual-service-config": [
#       {
#         "enable": "false",
#         "memory-size": 1024,
#         "name": "ova_new",
#         "num-cores": 2,
#         "vnc-port": 5901,
#         "vports": {
#           "vport": [
#             {
#               "connect-type": "BRIDGE",
#               "name": "mgmt",
#               "port": "mgmt"
#             },
#             {
#               "connect-type": "VTD",
#               "name": "57",
#               "port": "57"
#             },
#             {
#               "connect-type": "SRIOV",
#               "name": "VF1-58",
#               "port": "58"
#             }
#           ]
#         }
#       },
#       {
#         "enable": "false",
#         "memory-size": 4096,
#         "name": "vm_1",
#         "num-cores": 1,
#         "vnc-port": 5902,
#         "vports": {
#           "vport": [
#             {
#               "connect-type": "SRIOV",
#               "name": "VF1-57",
#               "port": "57"
#             }
#           ]
#         }
#       },
#       {
#         "enable": "false",
#         "memory-size": 4096,
#         "name": "vm_2",
#         "num-cores": 1,
#         "vnc-port": 0
#       }
#     ]
#   }
# }


# Using overridden

# Before state:
# -------------
# path: /rest/restconf/data/extreme-virtual-service:virtual-services-config/
# method: GET
# data:
# {
#   "extreme-virtual-service:virtual-services-config": {
#     "virtual-service-config": [
#       {
#         "enable": "false",
#         "memory-size": 1024,
#         "name": "ova_new",
#         "num-cores": 2,
#         "vnc-port": 5901,
#         "vports": {
#           "vport": [
#             {
#               "connect-type": "BRIDGE",
#               "name": "mgmt",
#               "port": "mgmt"
#             },
#             {
#               "connect-type": "VTD",
#               "name": "57",
#               "port": "57"
#             },
#             {
#               "connect-type": "SRIOV",
#               "name": "VF1-58",
#               "port": "58"
#             }
#           ]
#         }
#       },
#       {
#         "enable": "false",
#         "memory-size": 4096,
#         "name": "vm_1",
#         "num-cores": 1,
#         "vnc-port": 0
#       }
#     ]
#   }
# }

- name: Override provided configuration with the device configuration
  exos_guest_virtual_machines:
    config:
      - name: "vm_1"
        memory_size: 2048
        vnc:
          enabled: True
          port: 5903
        virtual_ports:
          name: "VF1-58"
          port: 58
          type: "SRIOV"
    state: replaced

# Module Execution Results:
# -------------------------
#
# "before": [
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 1024,
#         "name": "ova_new",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": True,
#             "port": 5901
#         },
#         "virtual_ports": [
#             {
#                 "type": "BRIDGE",
#                 "name": "mgmt",
#                 "port": "mgmt",
#                 "vlan": null
#             },
#             {
#                 "type": "VTD",
#                 "name": "57",
#                 "port": "57",
#                 "vlan": null
#             },
#             {
#                 "type": "SRIOV",
#                 "name": "VF1-58",
#                 "port": "58",
#                 "vlan": null
#             }
#         ]
#     },
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 4096,
#         "name": "vm_1",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": False,
#             "port": null
#         },
#         "virtual_ports": null
#     }
# ],
#
# "requests": [
#     {
#        "data": {
#          "extreme-virtual-service:virtual-service-config": [
#              {
#                "memory-size": 2048,
#                "vnc-port": 5903
#              }
#          ]
#        }
#        "method": "PATCH"
#        "path": "/rest/restconf/data/extreme-virtual-service:virtual-services-config/virtual-service-config=vm_1"
#     },
#     {
#        "data": {
#          "extreme-virtual-service:vports": [
#              {
#                "name": "VF2-58",
#                "port": 58,
#                "type": "SRIOV"
#              }
#          ]
#        }
#        "method": "POST"
#        "path": "/rest/restconf/data/extreme-virtual-service:virtual-services-config/virtual-service-config=vm_1/vports"
#     },
#     {
#        "data": {
#          "extreme-virtual-service:input": {
#            "name": "ova_new"
#          }
#        }
#        "method": "POST",
#        "path": "rest/restconf/operations/extreme-virtual-service:uninstall"
#     }
# ],
#
# "after": [
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 2048,
#         "name": "vm_1",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": True,
#             "port": 5903
#         },
#         "virtual_ports": [
#             {
#                 "type": "SRIOV",
#                 "name": "VF2-58",
#                 "port": "58",
#                 "vlan": null
#             }
#         ]
#     }
# ]
#
# After state:
# -------------
# path: /rest/restconf/data/extreme-virtual-service:virtual-services-config/
# method: GET
# data:
# {
#   "extreme-virtual-service:virtual-services-config": {
#     "virtual-service-config": [
#       {
#         "enable": "false",
#         "memory-size": 2048,
#         "name": "vm_1",
#         "num-cores": 2,
#         "vnc-port": 5903
#         "vports": {
#           "vport": [
#             {
#               "connect-type": "SRIOV",
#               "name": "VF2-58",
#               "port": "58"
#             }
#           ]
#         }
#       }
#     ]
#   }
# }
# Using replaced

# Before state:
# -------------
# path: /rest/restconf/data/extreme-virtual-service:virtual-services-config/
# method: GET
# data:
# {
#   "extreme-virtual-service:virtual-services-config": {
#     "virtual-service-config": [
#       {
#         "enable": "false",
#         "memory-size": 1024,
#         "name": "ova_new",
#         "num-cores": 2,
#         "vnc-port": 5901,
#         "vports": {
#           "vport": [
#             {
#               "connect-type": "BRIDGE",
#               "name": "mgmt",
#               "port": "mgmt"
#             },
#             {
#               "connect-type": "VTD",
#               "name": "57",
#               "port": "57"
#             },
#             {
#               "connect-type": "SRIOV",
#               "name": "VF1-58",
#               "port": "58"
#             }
#           ]
#         }
#       },
#       {
#         "enable": "false",
#         "memory-size": 4096,
#         "name": "vm_1",
#         "num-cores": 1,
#         "vnc-port": 0
#       }
#     ]
#   }
# }

- name: Replace provided configuration with the device configuration
  exos_guest_virtual_machines:
    config:
      - name: "vm_1"
        num_cores: 2
        memory_size: 2048
        vnc:
          enabled: True
          port: 5903
      - name: "ova_new"
        virtual_ports:
          name: "VF2-58"
          port: 58
          type: "SRIOV"
    state: replaced

# Module Execution Results:
# -------------------------
#
# "before": [
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 1024,
#         "name": "ova_new",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": True,
#             "port": 5901
#         },
#         "virtual_ports": [
#             {
#                 "type": "BRIDGE",
#                 "name": "mgmt",
#                 "port": "mgmt",
#                 "vlan": null
#             },
#             {
#                 "type": "VTD",
#                 "name": "57",
#                 "port": "57",
#                 "vlan": null
#             },
#             {
#                 "type": "SRIOV",
#                 "name": "VF1-58",
#                 "port": "58",
#                 "vlan": null
#             }
#         ]
#     },
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 4096,
#         "name": "vm_1",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": False,
#             "port": null
#         },
#         "virtual_ports": null
#     }
# ],
#
# "requests": [
#     {
#        "data": {
#          "extreme-virtual-service:virtual-service-config": [
#              {
#                "memory-size": 2048,
#                "num-cores": 2,
#                "vnc-port": 5903
#              }
#          ]
#        }
#        "method": "PATCH"
#        "path": "/rest/restconf/data/extreme-virtual-service:virtual-services-config/virtual-service-config=vm_1"
#     },
#     {
#        "data": {
#          "extreme-virtual-service:vports": [
#              {
#                "name": "VF2-58",
#                "port": 58,
#                "type": "SRIOV"
#              }
#          ]
#        }
#        "method": "PATCH"
#        "path": "/rest/restconf/data/extreme-virtual-service:virtual-services-config/virtual-service-config=ova_new/vports"
#     },
#     {
#        "method": "DELETE",
#        "path": "/rest/restconf/data/extreme-virtual-service:virtual-services-config/virtual-service-config=ova_new/vports/vport=mgmt"
#     },
#     {
#        "method": "DELETE",
#        "path": "/rest/restconf/data/extreme-virtual-service:virtual-services-config/virtual-service-config=ova_new/vports/vport=57"
#     },
#     {
#        "method": "DELETE",
#        "path": "/rest/restconf/data/extreme-virtual-service:virtual-services-config/virtual-service-config=ova_new/vports/vport=VF1-58"
#     }
# ],
#
# "after": [
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 1024,
#         "name": "ova_new",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": True,
#             "port": 5901
#         },
#         "virtual_ports": [
#             {
#                 "type": "SRIOV",
#                 "name": "VF2-58",
#                 "port": "58",
#                 "vlan": null
#             }
#         ]
#     },
#     {
#         "auto_started": False,
#         "image": "/usr/local/vm/packages/TPVM_Ubuntu16.04_25Feb2019.qcow2",
#         "memory_size": 2048,
#         "name": "vm_1",
#         "num_cores": 2,
#         "operational_state": "started",
#         "vnc": {
#             "enabled": True,
#             "port": 5903
#         },
#         "virtual_ports": null
#     }
# ]
#
# After state:
# -------------
# path: /rest/restconf/data/extreme-virtual-service:virtual-services-config/
# method: GET
# data:
# {
#   "extreme-virtual-service:virtual-services-config": {
#     "virtual-service-config": [
#       {
#         "enable": "false",
#         "memory-size": 1024,
#         "name": "ova_new",
#         "num-cores": 2,
#         "vnc-port": 5901,
#         "vports": {
#           "vport": [
#             {
#               "connect-type": "SRIOV",
#               "name": "VF2-58",
#               "port": "58"
#             }
#           ]
#         }
#       },
#       {
#         "enable": "false",
#         "memory-size": 2048,
#         "name": "vm_1",
#         "num-cores": 2,
#         "vnc-port": 5903
#       }
#     ]
#   }
# }

"""
RETURN = """
before:
  description: The configuration prior to the model invocation.
  returned: always
  sample: >
    The configuration returned will always be in the same format
     of the parameters above.
  type: list
after:
  description: The resulting configuration model invocation.
  returned: when changed
  sample: >
    The configuration returned will always be in the same format
     of the parameters above.
  type: list
requests:
  description: The set of requests pushed to the remote device.
  returned: always
  type: list
  sample: [{"data": "...", "method": "...", "path": "..."}, {"data": "...", "method": "...", "path": "..."}, {"data": "...", "method": "...", "path": "..."}]
"""


from ansible.module_utils.basic import AnsibleModule
from ansible.module_utils.network.exos.argspec.guest_virtual_machines.guest_virtual_machines import Guest_virtual_machinesArgs
from ansible.module_utils.network.exos.config.guest_virtual_machines.guest_virtual_machines import Guest_virtual_machines


def main():
    """
    Main entry point for module execution

    :returns: the result form module invocation
    """
    required_if = [('state', 'merged', ('config', )),
                   ('state', 'replaced', ('config', ))]

    module = AnsibleModule(argument_spec=Guest_virtual_machinesArgs.argument_spec, required_if=required_if,
                           supports_check_mode=True)

    result = Guest_virtual_machines(module).execute_module()
    module.exit_json(**result)


if __name__ == '__main__':
    main()
