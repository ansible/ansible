#!/usr/bin/python
# -*- coding: utf-8 -*-
# Copyright 2019 Red Hat
# GNU General Public License v3.0+
# (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

#############################################
#                WARNING                    #
#############################################
#
# This file is auto generated by the resource
#   module builder playbook.
#
# Do not edit this file manually.
#
# Changes to this file will be over written
#   by the resource module builder.
#
# Changes should be made in the model used to
#   generate this file or in the resource module
#   builder template.
#
#############################################

"""
The module file for exos_interfaces
"""

from __future__ import absolute_import, division, print_function
__metaclass__ = type

ANSIBLE_METADATA = {
    'metadata_version': '1.1',
    'status': ['preview'],
    'supported_by': 'community'
}

DOCUMENTATION = """
---
module: exos_interfaces
version_added: "2.10"
short_description: Manage interface attributes on EXOS platforms
description: This module provides declarative management of interface attributes on Extreme Networks EXOS network devices.
author: Jayalakshmi Viswanathan (@jayalakshmiV)
notes:
  - Tested against EXOS 30.5
  - This module works with connection C(httpapi).
    See L(EXOS Platform Options,../network/user_guide/platform_exos.html)
options:
  config:
    description: A dictionary of interface options
    type: list
    elements: dict
    suboptions:        
      name:
        description:
          - Full name of the interface.
        type: str
        required: true
      description:
        description:
          - Interface description.
        type: str
      duplex:
        description:
          - Interface link status. Applicable for Ethernet interfaces only, either in half duplex, full duplex or in automatic state which negotiates the duplex automatically.
        type: str
        choices:
          - FULL
          - HALF
          - AUTO
      enabled:
        description:
          - Administrative state of the interface. Set the value to true to administratively enable the interface or false to disable it.
        type: bool
        default: true
      jumbo_frames:
        description:
          - Jumbo frames support on the interface.
        type: dict
        suboptions:
          enabled:
            description:
              - Enabling jumbo frame support on the interface.
            type: bool
            default: false
      speed:
        description:
          - Interface link speed. Applicable for Ethernet interfaces only.
        type: str
  state:
    description:
      - The state the configuration should be left in
    type: str
    choices:
      - merged
      - replaced
      - overridden
      - deleted
    default: merged
"""
EXAMPLES = """
# Using deleted
# Before state:
# -------------
# path: /rest/restconf/data/openconfig-interfaces:interfaces/
# method: GET
# data:
# {
#   "openconfig-interfaces:interfaces": {
#     "interface": [
#       {
#         "config": {
#           "description": "Port 1",
#           "enabled": true,
#           "name": "1",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         },  
#       },
#       {
#         "config": {
#           "description": "Port 2",
#           "enabled": true,
#           "name": "2",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         }, 
#       }
#     ]
#   }
# }
#
# vexos# show ports 1 info detail | grep Jumbo
# Jumbo:		Enabled
# vexos# show ports 2 info detail | grep Jumbo
# Jumbo:		Enabled

- name: Delete interface configuration for the given arguments
  exos_interfaces:
    config:
      - name: '2'
    state: deleted

# Module Execution Results:
# -------------------------
#
# "before": [
#     {
#         "enabled": true,
#         "description": "Port 1",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "1",
#         "speed": "SPEED_1GB"
#     },
#     {
#         "enabled": true,
#         "description": "Port 2",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "2",
#         "speed": "SPEED_1GB"
#     }
# ],
#
# "requests": [
#     {
#        "data": {
#          "openconfig-interfaces:config": {
#            "description": ""
#          }
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/openconfig-interfaces:interfaces/interface=2/config"
#     }
# ],
#
# "commands": [
#     {
#        "disable jumbo-frame ports 2",
#        "configure ports 2 auto on"
#     }    
# ],
#
# "after": [
#     {
#         "enabled": true,
#         "description": "Port 1",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "1",
#         "speed": "SPEED_1GB"
#     },
#     {
#         "enabled": true,
#         "description": "",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": false
#         },
#         "name": "2",
#         "speed": "SPEED_UNKNOWN"
#     }
# ]
#
# After state:
# -------------
#
# path: /rest/restconf/data/openconfig-interfaces:interfaces/
# method: GET
# data:
# {
#   "openconfig-interfaces:interfaces": {
#     "interface": [
#       {
#         "config": {
#           "description": "Port 1",
#           "enabled": true,
#           "name": "1",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         },  
#       },
#       {
#         "config": {
#           "description": "",
#           "enabled": true,
#           "name": "2",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_UNKNOWN"
#         }, 
#       }
#     ]
#   }
# }
#
# vexos# show ports 1 info detail | grep Jumbo
# Jumbo:		Enabled
# vexos# show ports 2 info detail | grep Jumbo
# Jumbo:		Disabled

# Using deleted without any config passed
#"(NOTE: This will delete all of configured resource module attributes from each configured interface)"
# Before state:
# -------------
# path: /rest/restconf/data/openconfig-interfaces:interfaces/
# method: GET
# data:
# {
#   "openconfig-interfaces:interfaces": {
#     "interface": [
#       {
#         "config": {
#           "description": "Port 1",
#           "enabled": true,
#           "name": "1",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         },  
#       },
#       {
#         "config": {
#           "description": "Port 2",
#           "enabled": true,
#           "name": "2",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         }, 
#       }
#     ]
#   }
# }
#
# vexos# show ports 1 info detail | grep Jumbo
# Jumbo:		Enabled
# vexos# show ports 2 info detail | grep Jumbo
# Jumbo:		Enabled

- name: Delete interface configuration for the given arguments
  exos_interfaces:
    state: deleted

# Module Execution Results:
# -------------------------
#
# "before": [
#     {
#         "enabled": true,
#         "description": "Port 1",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "1",
#         "speed": "SPEED_1GB"
#     },
#     {
#         "enabled": true,
#         "description": "Port 2",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "2",
#         "speed": "SPEED_1GB"
#     }
# ],
#
# "requests": [
#     {
#        "data": {
#          "openconfig-interfaces:config": {
#            "description": ""
#          }
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/openconfig-interfaces:interfaces/interface=1/config"
#     },
#     {
#        "data": {
#          "openconfig-interfaces:config": {
#            "description": ""
#          }
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/openconfig-interfaces:interfaces/interface=2/config"
#     }
# ],
#
# "commands": [
#     {
#        "disable jumbo-frame ports 1",
#        "configure ports 1 auto on",
#        "disable jumbo-frame ports 2",
#        "configure ports 2 auto on"
#     }    
# ],
#
# "after": [
#     {
#         "enabled": true,
#         "description": "",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": false
#         },
#         "name": "1",
#         "speed": "SPEED_UNKNOWN"
#     },
#     {
#         "enabled": true,
#         "description": "",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": false
#         },
#         "name": "2",
#         "speed": "SPEED_UNKNOWN"
#     }
# ]
#
# After state:
# -------------
#
# path: /rest/restconf/data/openconfig-interfaces:interfaces/
# method: GET
# data:
# {
#   "openconfig-interfaces:interfaces": {
#     "interface": [
#       {
#         "config": {
#           "description": "",
#           "enabled": true,
#           "name": "1",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_UNKNOWN"
#         },  
#       },
#       {
#         "config": {
#           "description": "",
#           "enabled": true,
#           "name": "2",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_UNKNOWN"
#         }, 
#       }
#     ]
#   }
# }
#
# vexos# show ports 1 info detail | grep Jumbo
# Jumbo:		Disabled
# vexos# show ports 2 info detail | grep Jumbo
# Jumbo:		Disabled


# Using merged
# Before state:
# -------------
# path: /rest/restconf/data/openconfig-interfaces:interfaces/
# method: GET
# data:
# {
#   "openconfig-interfaces:interfaces": {
#     "interface": [
#       {
#         "config": {
#           "description": "Port 1",
#           "enabled": true,
#           "name": "1",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         },  
#       },
#       {
#         "config": {
#           "description": "Port 2",
#           "enabled": true,
#           "name": "2",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         }, 
#       }
#     ]
#   }
# }
#
# vexos# show ports 1 info detail | grep Jumbo
# Jumbo:		Enabled
# vexos# show ports 2 info detail | grep Jumbo
# Jumbo:		Enabled

- name: Merge provided interface configuration with the device configuration
  exos_interfaces:
    config:
      - name: "1"
        enabled: false 
        jumbo_frames:
          enabled: false        
      - name: "2"
        description: "Interface 2"
        speed: "SPEED_100MB",
        duplex: "FULL"              
    state: merged

# Module Execution Results:
# -------------------------
#
# "before": [
#     {
#         "enabled": true,
#         "description": "Port 1",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "1",
#         "speed": "SPEED_1GB"
#     },
#     {
#         "enabled": true,
#         "description": "Port 2",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "2",
#         "speed": "SPEED_1GB"
#     }
# ],
#
# "requests": [
#     {
#        "data": {
#          "openconfig-interfaces:config": {
#            "enabled": false
#          }
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/openconfig-interfaces:interfaces/interface=1/config"
#     },    
#     {
#        "data": {
#          "openconfig-interfaces:config": {
#            "description": "Interface 2"
#          }
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/openconfig-interfaces:interfaces/interface=2/config"
#     },
#     {
#        "data": {
#          "openconfig-if-ethernet:config": {
#       	 "auto-negotiate": true,
#		     "port-speed": "SPEED_100MB",
#		     "duplex-mode": "FULL"
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/openconfig-interfaces:interfaces/interface=2/openconfig-if-ethernet:ethernet/config"
#     }
# ],
#
# "commands": [
#     {
#        "disable jumbo-frame ports 1"
#     }    
# ],
#
# "after": [
#     {
#         "enabled": false,
#         "description": "Port 1",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": false
#         },
#         "name": "1",
#         "speed": "SPEED_1GB"
#     },
#     {
#         "enabled": true,
#         "description": "Interface 2",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "2",
#         "speed": "SPEED_100MB"
#     }
# ]
#
# After state:
# -------------
#
# path: /rest/restconf/data/openconfig-interfaces:interfaces/
# method: GET
# data:
# {
#   "openconfig-interfaces:interfaces": {
#     "interface": [
#       {
#         "config": {
#           "description": "Port 1",
#           "enabled": false,
#           "name": "1",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         },  
#       },
#       {
#         "config": {
#           "description": "Interface 2",
#           "enabled": true,
#           "name": "2",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_100MB"
#         },
#       }
#     ]
#   }
# }
#
# vexos# show ports 1 info detail | grep Jumbo
# Jumbo:		Disabled
# vexos# show ports 2 info detail | grep Jumbo
# Jumbo:		Enabled


# Using overridden
# Before state:
# -------------
# path: /rest/restconf/data/openconfig-interfaces:interfaces/
# method: GET
# data:
# {
#   "openconfig-interfaces:interfaces": {
#     "interface": [
#       {
#         "config": {
#           "description": "Port 1",
#           "enabled": true,
#           "name": "1",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         },  
#       },
#       {
#         "config": {
#           "description": "Port 2",
#           "enabled": true,
#           "name": "2",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         }, 
#       }
#     ]
#   }
# }
#
# vexos# show ports 1 info detail | grep Jumbo
# Jumbo:		Enabled
# vexos# show ports 2 info detail | grep Jumbo
# Jumbo:		Enabled

- name: Override device configuration with the provided interface configuration
  exos_interfaces:
    config:
      - name: "1"
        description: "Interface 1",
        speed: "SPEED_100MB",
        duplex: "FULL"          
    state: overridden

# Module Execution Results:
# -------------------------
#
# "before": [
#     {
#         "enabled": true,
#         "description": "Port 1",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "1",
#         "speed": "SPEED_1GB"
#     },
#     {
#         "enabled": true,
#         "description": "Port 2",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "2",
#         "speed": "SPEED_1GB"
#     }
# ],
#
# "requests": [
#     {
#        "data": {
#          "openconfig-interfaces:config": {
#            "description": "Interface 1"
#          }
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/openconfig-interfaces:interfaces/interface=1/config"
#     },    
#     {
#        "data": {
#          "openconfig-if-ethernet:config": {
#       	 "auto-negotiate": true,
#		     "port-speed": "SPEED_100MB",
#		     "duplex-mode": "FULL"
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/openconfig-interfaces:interfaces/interface=1/openconfig-if-ethernet:ethernet/config"
#     },
#     {
#        "data": {
#          "openconfig-interfaces:config": {
#            "description": ""
#          }
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/openconfig-interfaces:interfaces/interface=2/config"
#     }
# ],
#
# "commands": [
#     {
#        "disable jumbo-frame ports 2",
#        "configure ports 2 auto on"
#     }    
# ],
#
# "after": [
#     {
#         "enabled": true,
#         "description": "Interface 1",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "1",
#         "speed": "SPEED_100MB"
#     },
#     {
#         "enabled": true,
#         "description": "",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": false
#         },
#         "name": "2",
#         "speed": "SPEED_UNKNOWN"
#     }
# ]
#
# After state:
# -------------
#
# path: /rest/restconf/data/openconfig-interfaces:interfaces/
# method: GET
# data:
# {
#   "openconfig-interfaces:interfaces": {
#     "interface": [
#       {
#         "config": {
#           "description": "Interface 1",
#           "enabled": true,
#           "name": "1",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_100MB"
#         },  
#       },
#       {
#         "config": {
#           "description": "",
#           "enabled": true,
#           "name": "2",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_UNKNOWN"
#         },
#       }
#     ]
#   }
# }
#
# vexos# show ports 1 info detail | grep Jumbo
# Jumbo:		Enabled
# vexos# show ports 2 info detail | grep Jumbo
# Jumbo:		Disabled


# Using replaced
# Before state:
# -------------
# path: /rest/restconf/data/openconfig-interfaces:interfaces/
# method: GET
# data:
# {
#   "openconfig-interfaces:interfaces": {
#     "interface": [
#       {
#         "config": {
#           "description": "Port 1",
#           "enabled": true,
#           "name": "1",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         },  
#       },
#       {
#         "config": {
#           "description": "Port 2",
#           "enabled": true,
#           "name": "2",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         }, 
#       }
#     ]
#   }
# }
#
# vexos# show ports 1 info detail | grep Jumbo
# Jumbo:		Enabled
# vexos# show ports 2 info detail | grep Jumbo
# Jumbo:		Enabled

- name: Replace device configuration with the provided interface configuration
  exos_interfaces:
    config:
      - name: "1"
        description: "Interface 1"        
      - name: "2"        
        speed: "SPEED_10GB",
        duplex: "FULL"
        jumbo_frames:
          enabled: false          
    state: replaced

# Module Execution Results:
# -------------------------
#
# "before": [
#     {
#         "enabled": true,
#         "description": "Port 1",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "1",
#         "speed": "SPEED_1GB"
#     },
#     {
#         "enabled": true,
#         "description": "Port 2",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "2",
#         "speed": "SPEED_1GB"
#     }
# ],
#
# "requests": [
#     {
#        "data": {
#          "openconfig-interfaces:config": {
#            "description": "Interface 1"
#          }
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/openconfig-interfaces:interfaces/interface=1/config"
#     },    
#     {
#        "data": {
#          "openconfig-if-ethernet:config": {
#       	 "auto-negotiate": true,
#		     "port-speed": "SPEED_10GB",
#		     "duplex-mode": "FULL"
#        }
#        "method": "PATCH",
#        "path": "rest/restconf/data/openconfig-interfaces:interfaces/interface=2/openconfig-if-ethernet:ethernet/config"
#     }
# ],
#
# "commands": [
#     {
#        "disable jumbo-frame ports 2"
#     }    
# ],
#
# "after": [
#     {
#         "enabled": true,
#         "description": "Interface 1",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": true
#         },
#         "name": "1",
#         "speed": "SPEED_1GB"
#     },
#     {
#         "enabled": true,
#         "description": "Port 2",
#         "duplex": "FULL",
#         "jumbo_frames": {
#             "enabled": false
#         },
#         "name": "2",
#         "speed": "SPEED_10GB"
#     }
# ]
#
# After state:
# -------------
#
# path: /rest/restconf/data/openconfig-interfaces:interfaces/
# method: GET
# data:
# {
#   "openconfig-interfaces:interfaces": {
#     "interface": [
#       {
#         "config": {
#           "description": "Interface 1",
#           "enabled": true,
#           "name": "1",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_1GB"
#         },  
#       },
#       {
#         "config": {
#           "description": "Port 2",
#           "enabled": true,
#           "name": "2",
#         },
#         "openconfig-if-ethernet:ethernet": {
#           "config": {
#             "auto-negotiate": true,
#             "duplex-mode": "FULL",
#             "port-speed": "SPEED_10GB"
#         },
#       }
#     ]
#   }
# }
#
# vexos# show ports 1 info detail | grep Jumbo
# Jumbo:		Enabled
# vexos# show ports 2 info detail | grep Jumbo
# Jumbo:		Disabled


"""
RETURN = """
before:
  description: The configuration prior to the model invocation.
  returned: always
  sample: >
    The configuration returned will always be in the same format
     of the parameters above.
  type: list
after:
  description: The resulting configuration model invocation.
  returned: when changed
  sample: >
    The configuration returned will always be in the same format
     of the parameters above.
  type: list
requests:
  description: The set of requests pushed to the remote device.
  returned: always
  type: list
  sample: [{"data": "...", "method": "...", "path": "..."}, {"data": "...", "method": "...", "path": "..."}, {"data": "...", "method": "...", "path": "..."}]
commands:
  description: The set of commands pushed to the remote device.
  returned: always
  type: list
  sample: ['command 1', 'command 2', 'command 3']
"""


from ansible.module_utils.basic import AnsibleModule
from ansible.module_utils.network.exos.argspec.interfaces.interfaces import InterfacesArgs
from ansible.module_utils.network.exos.config.interfaces.interfaces import Interfaces


def main():
    """
    Main entry point for module execution

    :returns: the result form module invocation
    """
    required_if = [('state', 'merged', ('config', )),
                   ('state', 'replaced', ('config', ))]    
    module = AnsibleModule(argument_spec=InterfacesArgs.argument_spec, required_if=required_if,
                           supports_check_mode=True)

    result = Interfaces(module).execute_module()
    module.exit_json(**result)


if __name__ == '__main__':
    main()
