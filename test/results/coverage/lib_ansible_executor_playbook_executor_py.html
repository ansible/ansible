


<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <title>Coverage for lib/ansible/executor/playbook_executor.py: 56%</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.hotkeys.js"></script>
    <script type="text/javascript" src="jquery.isonscreen.js"></script>
    <script type="text/javascript" src="coverage_html.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body class="pyfile">

<div id="header">
    <div class="content">
        <h1>Coverage for <b>lib/ansible/executor/playbook_executor.py</b> :
            <span class="pc_cov">56%</span>
        </h1>

        <img id="keyboard_icon" src="keybd_closed.png" alt="Show keyboard shortcuts" />

        <h2 class="stats">
            161 statements &nbsp;
            <span class="run hide_run shortkey_r button_toggle_run">100 run</span>
            <span class="mis shortkey_m button_toggle_mis">61 missing</span>
            <span class="exc shortkey_x button_toggle_exc">0 excluded</span>

            
                <span class="par run hide_run shortkey_p button_toggle_par">20 partial</span>
            
        </h2>
    </div>
</div>

<div class="help_panel">
    <img id="panel_icon" src="keybd_open.png" alt="Hide keyboard shortcuts" />
    <p class="legend">Hot-keys on this page</p>
    <div>
    <p class="keyhelp">
        <span class="key">r</span>
        <span class="key">m</span>
        <span class="key">x</span>
        <span class="key">p</span> &nbsp; toggle line displays
    </p>
    <p class="keyhelp">
        <span class="key">j</span>
        <span class="key">k</span> &nbsp; next/prev highlighted chunk
    </p>
    <p class="keyhelp">
        <span class="key">0</span> &nbsp; (zero) top of page
    </p>
    <p class="keyhelp">
        <span class="key">1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>

<div id="source">
    <table>
        <tr>
            <td class="linenos">
<p id="n1" class="pln"><a href="#n1">1</a></p>
<p id="n2" class="pln"><a href="#n2">2</a></p>
<p id="n3" class="pln"><a href="#n3">3</a></p>
<p id="n4" class="pln"><a href="#n4">4</a></p>
<p id="n5" class="pln"><a href="#n5">5</a></p>
<p id="n6" class="pln"><a href="#n6">6</a></p>
<p id="n7" class="pln"><a href="#n7">7</a></p>
<p id="n8" class="pln"><a href="#n8">8</a></p>
<p id="n9" class="pln"><a href="#n9">9</a></p>
<p id="n10" class="pln"><a href="#n10">10</a></p>
<p id="n11" class="pln"><a href="#n11">11</a></p>
<p id="n12" class="pln"><a href="#n12">12</a></p>
<p id="n13" class="pln"><a href="#n13">13</a></p>
<p id="n14" class="pln"><a href="#n14">14</a></p>
<p id="n15" class="pln"><a href="#n15">15</a></p>
<p id="n16" class="pln"><a href="#n16">16</a></p>
<p id="n17" class="pln"><a href="#n17">17</a></p>
<p id="n18" class="pln"><a href="#n18">18</a></p>
<p id="n19" class="stm run hide_run"><a href="#n19">19</a></p>
<p id="n20" class="stm run hide_run"><a href="#n20">20</a></p>
<p id="n21" class="pln"><a href="#n21">21</a></p>
<p id="n22" class="stm run hide_run"><a href="#n22">22</a></p>
<p id="n23" class="pln"><a href="#n23">23</a></p>
<p id="n24" class="stm run hide_run"><a href="#n24">24</a></p>
<p id="n25" class="stm run hide_run"><a href="#n25">25</a></p>
<p id="n26" class="stm run hide_run"><a href="#n26">26</a></p>
<p id="n27" class="stm run hide_run"><a href="#n27">27</a></p>
<p id="n28" class="stm run hide_run"><a href="#n28">28</a></p>
<p id="n29" class="stm run hide_run"><a href="#n29">29</a></p>
<p id="n30" class="stm run hide_run"><a href="#n30">30</a></p>
<p id="n31" class="stm run hide_run"><a href="#n31">31</a></p>
<p id="n32" class="stm run hide_run"><a href="#n32">32</a></p>
<p id="n33" class="pln"><a href="#n33">33</a></p>
<p id="n34" class="stm run hide_run"><a href="#n34">34</a></p>
<p id="n35" class="stm run hide_run"><a href="#n35">35</a></p>
<p id="n36" class="stm mis"><a href="#n36">36</a></p>
<p id="n37" class="stm mis"><a href="#n37">37</a></p>
<p id="n38" class="stm mis"><a href="#n38">38</a></p>
<p id="n39" class="pln"><a href="#n39">39</a></p>
<p id="n40" class="pln"><a href="#n40">40</a></p>
<p id="n41" class="stm run hide_run"><a href="#n41">41</a></p>
<p id="n42" class="pln"><a href="#n42">42</a></p>
<p id="n43" class="pln"><a href="#n43">43</a></p>
<p id="n44" class="pln"><a href="#n44">44</a></p>
<p id="n45" class="pln"><a href="#n45">45</a></p>
<p id="n46" class="pln"><a href="#n46">46</a></p>
<p id="n47" class="pln"><a href="#n47">47</a></p>
<p id="n48" class="stm run hide_run"><a href="#n48">48</a></p>
<p id="n49" class="stm run hide_run"><a href="#n49">49</a></p>
<p id="n50" class="stm run hide_run"><a href="#n50">50</a></p>
<p id="n51" class="stm run hide_run"><a href="#n51">51</a></p>
<p id="n52" class="stm run hide_run"><a href="#n52">52</a></p>
<p id="n53" class="stm run hide_run"><a href="#n53">53</a></p>
<p id="n54" class="stm run hide_run"><a href="#n54">54</a></p>
<p id="n55" class="stm run hide_run"><a href="#n55">55</a></p>
<p id="n56" class="pln"><a href="#n56">56</a></p>
<p id="n57" class="stm par run hide_run"><a href="#n57">57</a></p>
<p id="n58" class="stm mis"><a href="#n58">58</a></p>
<p id="n59" class="pln"><a href="#n59">59</a></p>
<p id="n60" class="stm run hide_run"><a href="#n60">60</a></p>
<p id="n61" class="pln"><a href="#n61">61</a></p>
<p id="n62" class="pln"><a href="#n62">62</a></p>
<p id="n63" class="pln"><a href="#n63">63</a></p>
<p id="n64" class="pln"><a href="#n64">64</a></p>
<p id="n65" class="pln"><a href="#n65">65</a></p>
<p id="n66" class="pln"><a href="#n66">66</a></p>
<p id="n67" class="pln"><a href="#n67">67</a></p>
<p id="n68" class="stm run hide_run"><a href="#n68">68</a></p>
<p id="n69" class="pln"><a href="#n69">69</a></p>
<p id="n70" class="stm run hide_run"><a href="#n70">70</a></p>
<p id="n71" class="pln"><a href="#n71">71</a></p>
<p id="n72" class="pln"><a href="#n72">72</a></p>
<p id="n73" class="pln"><a href="#n73">73</a></p>
<p id="n74" class="pln"><a href="#n74">74</a></p>
<p id="n75" class="pln"><a href="#n75">75</a></p>
<p id="n76" class="stm run hide_run"><a href="#n76">76</a></p>
<p id="n77" class="stm run hide_run"><a href="#n77">77</a></p>
<p id="n78" class="stm run hide_run"><a href="#n78">78</a></p>
<p id="n79" class="stm run hide_run"><a href="#n79">79</a></p>
<p id="n80" class="stm run hide_run"><a href="#n80">80</a></p>
<p id="n81" class="stm run hide_run"><a href="#n81">81</a></p>
<p id="n82" class="pln"><a href="#n82">82</a></p>
<p id="n83" class="pln"><a href="#n83">83</a></p>
<p id="n84" class="stm par run hide_run"><a href="#n84">84</a></p>
<p id="n85" class="stm mis"><a href="#n85">85</a></p>
<p id="n86" class="stm mis"><a href="#n86">86</a></p>
<p id="n87" class="pln"><a href="#n87">87</a></p>
<p id="n88" class="pln"><a href="#n88">88</a></p>
<p id="n89" class="stm run hide_run"><a href="#n89">89</a></p>
<p id="n90" class="stm run hide_run"><a href="#n90">90</a></p>
<p id="n91" class="pln"><a href="#n91">91</a></p>
<p id="n92" class="stm run hide_run"><a href="#n92">92</a></p>
<p id="n93" class="stm run hide_run"><a href="#n93">93</a></p>
<p id="n94" class="stm run hide_run"><a href="#n94">94</a></p>
<p id="n95" class="pln"><a href="#n95">95</a></p>
<p id="n96" class="stm run hide_run"><a href="#n96">96</a></p>
<p id="n97" class="stm par run hide_run"><a href="#n97">97</a></p>
<p id="n98" class="stm mis"><a href="#n98">98</a></p>
<p id="n99" class="pln"><a href="#n99">99</a></p>
<p id="n100" class="stm run hide_run"><a href="#n100">100</a></p>
<p id="n101" class="pln"><a href="#n101">101</a></p>
<p id="n102" class="pln"><a href="#n102">102</a></p>
<p id="n103" class="stm run hide_run"><a href="#n103">103</a></p>
<p id="n104" class="pln"><a href="#n104">104</a></p>
<p id="n105" class="pln"><a href="#n105">105</a></p>
<p id="n106" class="stm run hide_run"><a href="#n106">106</a></p>
<p id="n107" class="stm run hide_run"><a href="#n107">107</a></p>
<p id="n108" class="stm run hide_run"><a href="#n108">108</a></p>
<p id="n109" class="pln"><a href="#n109">109</a></p>
<p id="n110" class="stm par run hide_run"><a href="#n110">110</a></p>
<p id="n111" class="stm mis"><a href="#n111">111</a></p>
<p id="n112" class="stm mis"><a href="#n112">112</a></p>
<p id="n113" class="stm mis"><a href="#n113">113</a></p>
<p id="n114" class="stm mis"><a href="#n114">114</a></p>
<p id="n115" class="stm mis"><a href="#n115">115</a></p>
<p id="n116" class="stm mis"><a href="#n116">116</a></p>
<p id="n117" class="stm mis"><a href="#n117">117</a></p>
<p id="n118" class="stm mis"><a href="#n118">118</a></p>
<p id="n119" class="stm mis"><a href="#n119">119</a></p>
<p id="n120" class="pln"><a href="#n120">120</a></p>
<p id="n121" class="stm mis"><a href="#n121">121</a></p>
<p id="n122" class="stm mis"><a href="#n122">122</a></p>
<p id="n123" class="stm mis"><a href="#n123">123</a></p>
<p id="n124" class="stm mis"><a href="#n124">124</a></p>
<p id="n125" class="pln"><a href="#n125">125</a></p>
<p id="n126" class="stm mis"><a href="#n126">126</a></p>
<p id="n127" class="pln"><a href="#n127">127</a></p>
<p id="n128" class="pln"><a href="#n128">128</a></p>
<p id="n129" class="stm run hide_run"><a href="#n129">129</a></p>
<p id="n130" class="stm run hide_run"><a href="#n130">130</a></p>
<p id="n131" class="stm run hide_run"><a href="#n131">131</a></p>
<p id="n132" class="pln"><a href="#n132">132</a></p>
<p id="n133" class="stm par run hide_run"><a href="#n133">133</a></p>
<p id="n134" class="stm mis"><a href="#n134">134</a></p>
<p id="n135" class="pln"><a href="#n135">135</a></p>
<p id="n136" class="stm par run hide_run"><a href="#n136">136</a></p>
<p id="n137" class="pln"><a href="#n137">137</a></p>
<p id="n138" class="stm mis"><a href="#n138">138</a></p>
<p id="n139" class="pln"><a href="#n139">139</a></p>
<p id="n140" class="pln"><a href="#n140">140</a></p>
<p id="n141" class="stm run hide_run"><a href="#n141">141</a></p>
<p id="n142" class="pln"><a href="#n142">142</a></p>
<p id="n143" class="stm run hide_run"><a href="#n143">143</a></p>
<p id="n144" class="stm run hide_run"><a href="#n144">144</a></p>
<p id="n145" class="pln"><a href="#n145">145</a></p>
<p id="n146" class="stm run hide_run"><a href="#n146">146</a></p>
<p id="n147" class="pln"><a href="#n147">147</a></p>
<p id="n148" class="stm run hide_run"><a href="#n148">148</a></p>
<p id="n149" class="stm par run hide_run"><a href="#n149">149</a></p>
<p id="n150" class="stm mis"><a href="#n150">150</a></p>
<p id="n151" class="stm mis"><a href="#n151">151</a></p>
<p id="n152" class="stm run hide_run"><a href="#n152">152</a></p>
<p id="n153" class="pln"><a href="#n153">153</a></p>
<p id="n154" class="stm run hide_run"><a href="#n154">154</a></p>
<p id="n155" class="pln"><a href="#n155">155</a></p>
<p id="n156" class="stm run hide_run"><a href="#n156">156</a></p>
<p id="n157" class="pln"><a href="#n157">157</a></p>
<p id="n158" class="pln"><a href="#n158">158</a></p>
<p id="n159" class="stm par run hide_run"><a href="#n159">159</a></p>
<p id="n160" class="stm mis"><a href="#n160">160</a></p>
<p id="n161" class="stm mis"><a href="#n161">161</a></p>
<p id="n162" class="pln"><a href="#n162">162</a></p>
<p id="n163" class="pln"><a href="#n163">163</a></p>
<p id="n164" class="pln"><a href="#n164">164</a></p>
<p id="n165" class="pln"><a href="#n165">165</a></p>
<p id="n166" class="pln"><a href="#n166">166</a></p>
<p id="n167" class="stm run hide_run"><a href="#n167">167</a></p>
<p id="n168" class="pln"><a href="#n168">168</a></p>
<p id="n169" class="pln"><a href="#n169">169</a></p>
<p id="n170" class="stm run hide_run"><a href="#n170">170</a></p>
<p id="n171" class="stm run hide_run"><a href="#n171">171</a></p>
<p id="n172" class="stm run hide_run"><a href="#n172">172</a></p>
<p id="n173" class="pln"><a href="#n173">173</a></p>
<p id="n174" class="pln"><a href="#n174">174</a></p>
<p id="n175" class="pln"><a href="#n175">175</a></p>
<p id="n176" class="stm run hide_run"><a href="#n176">176</a></p>
<p id="n177" class="stm run hide_run"><a href="#n177">177</a></p>
<p id="n178" class="pln"><a href="#n178">178</a></p>
<p id="n179" class="pln"><a href="#n179">179</a></p>
<p id="n180" class="stm run hide_run"><a href="#n180">180</a></p>
<p id="n181" class="pln"><a href="#n181">181</a></p>
<p id="n182" class="stm run hide_run"><a href="#n182">182</a></p>
<p id="n183" class="stm run hide_run"><a href="#n183">183</a></p>
<p id="n184" class="pln"><a href="#n184">184</a></p>
<p id="n185" class="stm run hide_run"><a href="#n185">185</a></p>
<p id="n186" class="pln"><a href="#n186">186</a></p>
<p id="n187" class="stm par run hide_run"><a href="#n187">187</a></p>
<p id="n188" class="stm mis"><a href="#n188">188</a></p>
<p id="n189" class="pln"><a href="#n189">189</a></p>
<p id="n190" class="pln"><a href="#n190">190</a></p>
<p id="n191" class="stm par run hide_run"><a href="#n191">191</a></p>
<p id="n192" class="stm par run hide_run"><a href="#n192">192</a></p>
<p id="n193" class="stm mis"><a href="#n193">193</a></p>
<p id="n194" class="stm mis"><a href="#n194">194</a></p>
<p id="n195" class="stm mis"><a href="#n195">195</a></p>
<p id="n196" class="stm mis"><a href="#n196">196</a></p>
<p id="n197" class="stm mis"><a href="#n197">197</a></p>
<p id="n198" class="stm mis"><a href="#n198">198</a></p>
<p id="n199" class="stm mis"><a href="#n199">199</a></p>
<p id="n200" class="stm mis"><a href="#n200">200</a></p>
<p id="n201" class="pln"><a href="#n201">201</a></p>
<p id="n202" class="stm mis"><a href="#n202">202</a></p>
<p id="n203" class="pln"><a href="#n203">203</a></p>
<p id="n204" class="stm mis"><a href="#n204">204</a></p>
<p id="n205" class="stm mis"><a href="#n205">205</a></p>
<p id="n206" class="stm mis"><a href="#n206">206</a></p>
<p id="n207" class="stm mis"><a href="#n207">207</a></p>
<p id="n208" class="pln"><a href="#n208">208</a></p>
<p id="n209" class="stm run hide_run"><a href="#n209">209</a></p>
<p id="n210" class="pln"><a href="#n210">210</a></p>
<p id="n211" class="pln"><a href="#n211">211</a></p>
<p id="n212" class="stm run hide_run"><a href="#n212">212</a></p>
<p id="n213" class="stm run hide_run"><a href="#n213">213</a></p>
<p id="n214" class="pln"><a href="#n214">214</a></p>
<p id="n215" class="stm par run hide_run"><a href="#n215">215</a></p>
<p id="n216" class="stm mis"><a href="#n216">216</a></p>
<p id="n217" class="pln"><a href="#n217">217</a></p>
<p id="n218" class="pln"><a href="#n218">218</a></p>
<p id="n219" class="stm par run hide_run"><a href="#n219">219</a></p>
<p id="n220" class="stm run hide_run"><a href="#n220">220</a></p>
<p id="n221" class="stm par run hide_run"><a href="#n221">221</a></p>
<p id="n222" class="stm par run hide_run"><a href="#n222">222</a></p>
<p id="n223" class="pln"><a href="#n223">223</a></p>
<p id="n224" class="stm par run hide_run"><a href="#n224">224</a></p>
<p id="n225" class="stm mis"><a href="#n225">225</a></p>
<p id="n226" class="stm mis"><a href="#n226">226</a></p>
<p id="n227" class="pln"><a href="#n227">227</a></p>
<p id="n228" class="stm run hide_run"><a href="#n228">228</a></p>
<p id="n229" class="pln"><a href="#n229">229</a></p>
<p id="n230" class="stm run hide_run"><a href="#n230">230</a></p>
<p id="n231" class="pln"><a href="#n231">231</a></p>
<p id="n232" class="pln"><a href="#n232">232</a></p>
<p id="n233" class="pln"><a href="#n233">233</a></p>
<p id="n234" class="pln"><a href="#n234">234</a></p>
<p id="n235" class="pln"><a href="#n235">235</a></p>
<p id="n236" class="pln"><a href="#n236">236</a></p>
<p id="n237" class="stm run hide_run"><a href="#n237">237</a></p>
<p id="n238" class="stm run hide_run"><a href="#n238">238</a></p>
<p id="n239" class="pln"><a href="#n239">239</a></p>
<p id="n240" class="pln"><a href="#n240">240</a></p>
<p id="n241" class="pln"><a href="#n241">241</a></p>
<p id="n242" class="stm run hide_run"><a href="#n242">242</a></p>
<p id="n243" class="stm par run hide_run"><a href="#n243">243</a></p>
<p id="n244" class="stm run hide_run"><a href="#n244">244</a></p>
<p id="n245" class="pln"><a href="#n245">245</a></p>
<p id="n246" class="stm run hide_run"><a href="#n246">246</a></p>
<p id="n247" class="stm run hide_run"><a href="#n247">247</a></p>
<p id="n248" class="pln"><a href="#n248">248</a></p>
<p id="n249" class="stm par run hide_run"><a href="#n249">249</a></p>
<p id="n250" class="pln"><a href="#n250">250</a></p>
<p id="n251" class="stm run hide_run"><a href="#n251">251</a></p>
<p id="n252" class="pln"><a href="#n252">252</a></p>
<p id="n253" class="pln"><a href="#n253">253</a></p>
<p id="n254" class="pln"><a href="#n254">254</a></p>
<p id="n255" class="pln"><a href="#n255">255</a></p>
<p id="n256" class="stm par run hide_run"><a href="#n256">256</a></p>
<p id="n257" class="stm run hide_run"><a href="#n257">257</a></p>
<p id="n258" class="stm run hide_run"><a href="#n258">258</a></p>
<p id="n259" class="pln"><a href="#n259">259</a></p>
<p id="n260" class="stm mis"><a href="#n260">260</a></p>
<p id="n261" class="stm mis"><a href="#n261">261</a></p>
<p id="n262" class="stm mis"><a href="#n262">262</a></p>
<p id="n263" class="stm mis"><a href="#n263">263</a></p>
<p id="n264" class="pln"><a href="#n264">264</a></p>
<p id="n265" class="stm mis"><a href="#n265">265</a></p>
<p id="n266" class="pln"><a href="#n266">266</a></p>
<p id="n267" class="pln"><a href="#n267">267</a></p>
<p id="n268" class="pln"><a href="#n268">268</a></p>
<p id="n269" class="pln"><a href="#n269">269</a></p>
<p id="n270" class="stm mis"><a href="#n270">270</a></p>
<p id="n271" class="stm mis"><a href="#n271">271</a></p>
<p id="n272" class="stm mis"><a href="#n272">272</a></p>
<p id="n273" class="pln"><a href="#n273">273</a></p>
<p id="n274" class="stm run hide_run"><a href="#n274">274</a></p>
<p id="n275" class="pln"><a href="#n275">275</a></p>
<p id="n276" class="stm run hide_run"><a href="#n276">276</a></p>
<p id="n277" class="pln"><a href="#n277">277</a></p>
<p id="n278" class="pln"><a href="#n278">278</a></p>
<p id="n279" class="pln"><a href="#n279">279</a></p>
<p id="n280" class="pln"><a href="#n280">280</a></p>
<p id="n281" class="pln"><a href="#n281">281</a></p>
<p id="n282" class="stm mis"><a href="#n282">282</a></p>
<p id="n283" class="stm mis"><a href="#n283">283</a></p>
<p id="n284" class="stm mis"><a href="#n284">284</a></p>
<p id="n285" class="stm mis"><a href="#n285">285</a></p>
<p id="n286" class="stm mis"><a href="#n286">286</a></p>
<p id="n287" class="stm mis"><a href="#n287">287</a></p>
<p id="n288" class="stm mis"><a href="#n288">288</a></p>
<p id="n289" class="stm mis"><a href="#n289">289</a></p>
<p id="n290" class="pln"><a href="#n290">290</a></p>
<p id="n291" class="stm mis"><a href="#n291">291</a></p>

            </td>
            <td class="text">
<p id="t1" class="pln"><span class="com"># (c) 2012-2014, Michael DeHaan &lt;michael.dehaan@gmail.com></span><span class="strut">&nbsp;</span></p>
<p id="t2" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t3" class="pln"><span class="com"># This file is part of Ansible</span><span class="strut">&nbsp;</span></p>
<p id="t4" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t5" class="pln"><span class="com"># Ansible is free software: you can redistribute it and/or modify</span><span class="strut">&nbsp;</span></p>
<p id="t6" class="pln"><span class="com"># it under the terms of the GNU General Public License as published by</span><span class="strut">&nbsp;</span></p>
<p id="t7" class="pln"><span class="com"># the Free Software Foundation, either version 3 of the License, or</span><span class="strut">&nbsp;</span></p>
<p id="t8" class="pln"><span class="com"># (at your option) any later version.</span><span class="strut">&nbsp;</span></p>
<p id="t9" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t10" class="pln"><span class="com"># Ansible is distributed in the hope that it will be useful,</span><span class="strut">&nbsp;</span></p>
<p id="t11" class="pln"><span class="com"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="strut">&nbsp;</span></p>
<p id="t12" class="pln"><span class="com"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><span class="strut">&nbsp;</span></p>
<p id="t13" class="pln"><span class="com"># GNU General Public License for more details.</span><span class="strut">&nbsp;</span></p>
<p id="t14" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t15" class="pln"><span class="com"># You should have received a copy of the GNU General Public License</span><span class="strut">&nbsp;</span></p>
<p id="t16" class="pln"><span class="com"># along with Ansible.  If not, see &lt;http://www.gnu.org/licenses/>.</span><span class="strut">&nbsp;</span></p>
<p id="t17" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t18" class="pln"><span class="com"># Make coding more python3-ish</span><span class="strut">&nbsp;</span></p>
<p id="t19" class="stm run hide_run"><span class="key">from</span> <span class="nam">__future__</span> <span class="key">import</span> <span class="op">(</span><span class="nam">absolute_import</span><span class="op">,</span> <span class="nam">division</span><span class="op">,</span> <span class="nam">print_function</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t20" class="stm run hide_run"><span class="nam">__metaclass__</span> <span class="op">=</span> <span class="nam">type</span><span class="strut">&nbsp;</span></p>
<p id="t21" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t22" class="stm run hide_run"><span class="key">import</span> <span class="nam">os</span><span class="strut">&nbsp;</span></p>
<p id="t23" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t24" class="stm run hide_run"><span class="key">from</span> <span class="nam">ansible</span> <span class="key">import</span> <span class="nam">constants</span> <span class="key">as</span> <span class="nam">C</span><span class="strut">&nbsp;</span></p>
<p id="t25" class="stm run hide_run"><span class="key">from</span> <span class="nam">ansible</span><span class="op">.</span><span class="nam">executor</span><span class="op">.</span><span class="nam">task_queue_manager</span> <span class="key">import</span> <span class="nam">TaskQueueManager</span><span class="strut">&nbsp;</span></p>
<p id="t26" class="stm run hide_run"><span class="key">from</span> <span class="nam">ansible</span><span class="op">.</span><span class="nam">module_utils</span><span class="op">.</span><span class="nam">_text</span> <span class="key">import</span> <span class="nam">to_native</span><span class="op">,</span> <span class="nam">to_text</span><span class="strut">&nbsp;</span></p>
<p id="t27" class="stm run hide_run"><span class="key">from</span> <span class="nam">ansible</span><span class="op">.</span><span class="nam">playbook</span> <span class="key">import</span> <span class="nam">Playbook</span><span class="strut">&nbsp;</span></p>
<p id="t28" class="stm run hide_run"><span class="key">from</span> <span class="nam">ansible</span><span class="op">.</span><span class="nam">template</span> <span class="key">import</span> <span class="nam">Templar</span><span class="strut">&nbsp;</span></p>
<p id="t29" class="stm run hide_run"><span class="key">from</span> <span class="nam">ansible</span><span class="op">.</span><span class="nam">utils</span><span class="op">.</span><span class="nam">helpers</span> <span class="key">import</span> <span class="nam">pct_to_int</span><span class="strut">&nbsp;</span></p>
<p id="t30" class="stm run hide_run"><span class="key">from</span> <span class="nam">ansible</span><span class="op">.</span><span class="nam">module_utils</span><span class="op">.</span><span class="nam">parsing</span><span class="op">.</span><span class="nam">convert_bool</span> <span class="key">import</span> <span class="nam">boolean</span><span class="strut">&nbsp;</span></p>
<p id="t31" class="stm run hide_run"><span class="key">from</span> <span class="nam">ansible</span><span class="op">.</span><span class="nam">utils</span><span class="op">.</span><span class="nam">path</span> <span class="key">import</span> <span class="nam">makedirs_safe</span><span class="strut">&nbsp;</span></p>
<p id="t32" class="stm run hide_run"><span class="key">from</span> <span class="nam">ansible</span><span class="op">.</span><span class="nam">utils</span><span class="op">.</span><span class="nam">ssh_functions</span> <span class="key">import</span> <span class="nam">check_for_controlpersist</span><span class="strut">&nbsp;</span></p>
<p id="t33" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t34" class="stm run hide_run"><span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t35" class="stm run hide_run">    <span class="key">from</span> <span class="nam">__main__</span> <span class="key">import</span> <span class="nam">display</span><span class="strut">&nbsp;</span></p>
<p id="t36" class="stm mis"><span class="key">except</span> <span class="nam">ImportError</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t37" class="stm mis">    <span class="key">from</span> <span class="nam">ansible</span><span class="op">.</span><span class="nam">utils</span><span class="op">.</span><span class="nam">display</span> <span class="key">import</span> <span class="nam">Display</span><span class="strut">&nbsp;</span></p>
<p id="t38" class="stm mis">    <span class="nam">display</span> <span class="op">=</span> <span class="nam">Display</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t39" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t40" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t41" class="stm run hide_run"><span class="key">class</span> <span class="nam">PlaybookExecutor</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t42" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t43" class="pln">    <span class="str">'''</span><span class="strut">&nbsp;</span></p>
<p id="t44" class="pln"><span class="str">    This is the primary class for executing playbooks, and thus the</span><span class="strut">&nbsp;</span></p>
<p id="t45" class="pln"><span class="str">    basis for bin/ansible-playbook operation.</span><span class="strut">&nbsp;</span></p>
<p id="t46" class="pln"><span class="str">    '''</span><span class="strut">&nbsp;</span></p>
<p id="t47" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t48" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">playbooks</span><span class="op">,</span> <span class="nam">inventory</span><span class="op">,</span> <span class="nam">variable_manager</span><span class="op">,</span> <span class="nam">loader</span><span class="op">,</span> <span class="nam">options</span><span class="op">,</span> <span class="nam">passwords</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t49" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">_playbooks</span> <span class="op">=</span> <span class="nam">playbooks</span><span class="strut">&nbsp;</span></p>
<p id="t50" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">_inventory</span> <span class="op">=</span> <span class="nam">inventory</span><span class="strut">&nbsp;</span></p>
<p id="t51" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">_variable_manager</span> <span class="op">=</span> <span class="nam">variable_manager</span><span class="strut">&nbsp;</span></p>
<p id="t52" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">_loader</span> <span class="op">=</span> <span class="nam">loader</span><span class="strut">&nbsp;</span></p>
<p id="t53" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">_options</span> <span class="op">=</span> <span class="nam">options</span><span class="strut">&nbsp;</span></p>
<p id="t54" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">passwords</span> <span class="op">=</span> <span class="nam">passwords</span><span class="strut">&nbsp;</span></p>
<p id="t55" class="stm run hide_run">        <span class="nam">self</span><span class="op">.</span><span class="nam">_unreachable_hosts</span> <span class="op">=</span> <span class="nam">dict</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t56" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t57" class="stm par run hide_run"><span class="annotate short">57&#x202F;&#x219B;&#x202F;58</span><span class="annotate long">line 57 didn't jump to line 58, because the condition on line 57 was never true</span>        <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">listhosts</span> <span class="key">or</span> <span class="nam">options</span><span class="op">.</span><span class="nam">listtasks</span> <span class="key">or</span> <span class="nam">options</span><span class="op">.</span><span class="nam">listtags</span> <span class="key">or</span> <span class="nam">options</span><span class="op">.</span><span class="nam">syntax</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t58" class="stm mis">            <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span> <span class="op">=</span> <span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t59" class="pln">        <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t60" class="stm run hide_run">            <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span> <span class="op">=</span> <span class="nam">TaskQueueManager</span><span class="op">(</span><span class="nam">inventory</span><span class="op">=</span><span class="nam">inventory</span><span class="op">,</span> <span class="nam">variable_manager</span><span class="op">=</span><span class="nam">variable_manager</span><span class="op">,</span> <span class="nam">loader</span><span class="op">=</span><span class="nam">loader</span><span class="op">,</span> <span class="nam">options</span><span class="op">=</span><span class="nam">options</span><span class="op">,</span> <span class="nam">passwords</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">passwords</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t61" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t62" class="pln">        <span class="com"># Note: We run this here to cache whether the default ansible ssh</span><span class="strut">&nbsp;</span></p>
<p id="t63" class="pln">        <span class="com"># executable supports control persist.  Sometime in the future we may</span><span class="strut">&nbsp;</span></p>
<p id="t64" class="pln">        <span class="com"># need to enhance this to check that ansible_ssh_executable specified</span><span class="strut">&nbsp;</span></p>
<p id="t65" class="pln">        <span class="com"># in inventory is also cached.  We can't do this caching at the point</span><span class="strut">&nbsp;</span></p>
<p id="t66" class="pln">        <span class="com"># where it is used (in task_executor) because that is post-fork and</span><span class="strut">&nbsp;</span></p>
<p id="t67" class="pln">        <span class="com"># therefore would be discarded after every task.</span><span class="strut">&nbsp;</span></p>
<p id="t68" class="stm run hide_run">        <span class="nam">check_for_controlpersist</span><span class="op">(</span><span class="nam">C</span><span class="op">.</span><span class="nam">ANSIBLE_SSH_EXECUTABLE</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t69" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t70" class="stm run hide_run">    <span class="key">def</span> <span class="nam">run</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t71" class="pln">        <span class="str">'''</span><span class="strut">&nbsp;</span></p>
<p id="t72" class="pln"><span class="str">        Run the given playbook, based on the settings in the play which</span><span class="strut">&nbsp;</span></p>
<p id="t73" class="pln"><span class="str">        may limit the runs to serialized groups, etc.</span><span class="strut">&nbsp;</span></p>
<p id="t74" class="pln"><span class="str">        '''</span><span class="strut">&nbsp;</span></p>
<p id="t75" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t76" class="stm run hide_run">        <span class="nam">result</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t77" class="stm run hide_run">        <span class="nam">entrylist</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t78" class="stm run hide_run">        <span class="nam">entry</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t79" class="stm run hide_run">        <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t80" class="stm run hide_run">            <span class="key">for</span> <span class="nam">playbook_path</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_playbooks</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t81" class="stm run hide_run">                <span class="nam">pb</span> <span class="op">=</span> <span class="nam">Playbook</span><span class="op">.</span><span class="nam">load</span><span class="op">(</span><span class="nam">playbook_path</span><span class="op">,</span> <span class="nam">variable_manager</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">_variable_manager</span><span class="op">,</span> <span class="nam">loader</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">_loader</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t82" class="pln">                <span class="com"># FIXME: move out of inventory self._inventory.set_playbook_basedir(os.path.realpath(os.path.dirname(playbook_path)))</span><span class="strut">&nbsp;</span></p>
<p id="t83" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t84" class="stm par run hide_run"><span class="annotate short">84&#x202F;&#x219B;&#x202F;85</span><span class="annotate long">line 84 didn't jump to line 85, because the condition on line 84 was never true</span>                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span> <span class="key">is</span> <span class="nam">None</span><span class="op">:</span>  <span class="com"># we are doing a listing</span><span class="strut">&nbsp;</span></p>
<p id="t85" class="stm mis">                    <span class="nam">entry</span> <span class="op">=</span> <span class="op">{</span><span class="str">'playbook'</span><span class="op">:</span> <span class="nam">playbook_path</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t86" class="stm mis">                    <span class="nam">entry</span><span class="op">[</span><span class="str">'plays'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t87" class="pln">                <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t88" class="pln">                    <span class="com"># make sure the tqm has callbacks loaded</span><span class="strut">&nbsp;</span></p>
<p id="t89" class="stm run hide_run">                    <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">load_callbacks</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t90" class="stm run hide_run">                    <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">send_callback</span><span class="op">(</span><span class="str">'v2_playbook_on_start'</span><span class="op">,</span> <span class="nam">pb</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t91" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t92" class="stm run hide_run">                <span class="nam">i</span> <span class="op">=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t93" class="stm run hide_run">                <span class="nam">plays</span> <span class="op">=</span> <span class="nam">pb</span><span class="op">.</span><span class="nam">get_plays</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t94" class="stm run hide_run">                <span class="nam">display</span><span class="op">.</span><span class="nam">vv</span><span class="op">(</span><span class="str">u'%d plays in %s'</span> <span class="op">%</span> <span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">plays</span><span class="op">)</span><span class="op">,</span> <span class="nam">to_text</span><span class="op">(</span><span class="nam">playbook_path</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t95" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t96" class="stm run hide_run">                <span class="key">for</span> <span class="nam">play</span> <span class="key">in</span> <span class="nam">plays</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t97" class="stm par run hide_run"><span class="annotate short">97&#x202F;&#x219B;&#x202F;98</span><span class="annotate long">line 97 didn't jump to line 98, because the condition on line 97 was never true</span>                    <span class="key">if</span> <span class="nam">play</span><span class="op">.</span><span class="nam">_included_path</span> <span class="key">is</span> <span class="key">not</span> <span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t98" class="stm mis">                        <span class="nam">self</span><span class="op">.</span><span class="nam">_loader</span><span class="op">.</span><span class="nam">set_basedir</span><span class="op">(</span><span class="nam">play</span><span class="op">.</span><span class="nam">_included_path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t99" class="pln">                    <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t100" class="stm run hide_run">                        <span class="nam">self</span><span class="op">.</span><span class="nam">_loader</span><span class="op">.</span><span class="nam">set_basedir</span><span class="op">(</span><span class="nam">pb</span><span class="op">.</span><span class="nam">_basedir</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t101" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t102" class="pln">                    <span class="com"># clear any filters which may have been applied to the inventory</span><span class="strut">&nbsp;</span></p>
<p id="t103" class="stm run hide_run">                    <span class="nam">self</span><span class="op">.</span><span class="nam">_inventory</span><span class="op">.</span><span class="nam">remove_restriction</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t104" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t105" class="pln">                    <span class="com"># Allow variables to be used in vars_prompt fields.</span><span class="strut">&nbsp;</span></p>
<p id="t106" class="stm run hide_run">                    <span class="nam">all_vars</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_variable_manager</span><span class="op">.</span><span class="nam">get_vars</span><span class="op">(</span><span class="nam">play</span><span class="op">=</span><span class="nam">play</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t107" class="stm run hide_run">                    <span class="nam">templar</span> <span class="op">=</span> <span class="nam">Templar</span><span class="op">(</span><span class="nam">loader</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">_loader</span><span class="op">,</span> <span class="nam">variables</span><span class="op">=</span><span class="nam">all_vars</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t108" class="stm run hide_run">                    <span class="nam">setattr</span><span class="op">(</span><span class="nam">play</span><span class="op">,</span> <span class="str">'vars_prompt'</span><span class="op">,</span> <span class="nam">templar</span><span class="op">.</span><span class="nam">template</span><span class="op">(</span><span class="nam">play</span><span class="op">.</span><span class="nam">vars_prompt</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t109" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t110" class="stm par run hide_run"><span class="annotate short">110&#x202F;&#x219B;&#x202F;111</span><span class="annotate long">line 110 didn't jump to line 111, because the condition on line 110 was never true</span>                    <span class="key">if</span> <span class="nam">play</span><span class="op">.</span><span class="nam">vars_prompt</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t111" class="stm mis">                        <span class="key">for</span> <span class="nam">var</span> <span class="key">in</span> <span class="nam">play</span><span class="op">.</span><span class="nam">vars_prompt</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t112" class="stm mis">                            <span class="nam">vname</span> <span class="op">=</span> <span class="nam">var</span><span class="op">[</span><span class="str">'name'</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t113" class="stm mis">                            <span class="nam">prompt</span> <span class="op">=</span> <span class="nam">var</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"prompt"</span><span class="op">,</span> <span class="nam">vname</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t114" class="stm mis">                            <span class="nam">default</span> <span class="op">=</span> <span class="nam">var</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"default"</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t115" class="stm mis">                            <span class="nam">private</span> <span class="op">=</span> <span class="nam">boolean</span><span class="op">(</span><span class="nam">var</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"private"</span><span class="op">,</span> <span class="nam">True</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t116" class="stm mis">                            <span class="nam">confirm</span> <span class="op">=</span> <span class="nam">boolean</span><span class="op">(</span><span class="nam">var</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"confirm"</span><span class="op">,</span> <span class="nam">False</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t117" class="stm mis">                            <span class="nam">encrypt</span> <span class="op">=</span> <span class="nam">var</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"encrypt"</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t118" class="stm mis">                            <span class="nam">salt_size</span> <span class="op">=</span> <span class="nam">var</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"salt_size"</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t119" class="stm mis">                            <span class="nam">salt</span> <span class="op">=</span> <span class="nam">var</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">"salt"</span><span class="op">,</span> <span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t120" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t121" class="stm mis">                            <span class="key">if</span> <span class="nam">vname</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_variable_manager</span><span class="op">.</span><span class="nam">extra_vars</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t122" class="stm mis">                                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t123" class="stm mis">                                    <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">send_callback</span><span class="op">(</span><span class="str">'v2_playbook_on_vars_prompt'</span><span class="op">,</span> <span class="nam">vname</span><span class="op">,</span> <span class="nam">private</span><span class="op">,</span> <span class="nam">prompt</span><span class="op">,</span> <span class="nam">encrypt</span><span class="op">,</span> <span class="nam">confirm</span><span class="op">,</span> <span class="nam">salt_size</span><span class="op">,</span> <span class="nam">salt</span><span class="op">,</span> <span class="nam">default</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t124" class="stm mis">                                    <span class="nam">play</span><span class="op">.</span><span class="nam">vars</span><span class="op">[</span><span class="nam">vname</span><span class="op">]</span> <span class="op">=</span> <span class="nam">display</span><span class="op">.</span><span class="nam">do_var_prompt</span><span class="op">(</span><span class="nam">vname</span><span class="op">,</span> <span class="nam">private</span><span class="op">,</span> <span class="nam">prompt</span><span class="op">,</span> <span class="nam">encrypt</span><span class="op">,</span> <span class="nam">confirm</span><span class="op">,</span> <span class="nam">salt_size</span><span class="op">,</span> <span class="nam">salt</span><span class="op">,</span> <span class="nam">default</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t125" class="pln">                                <span class="key">else</span><span class="op">:</span>  <span class="com"># we are either in --list-&lt;option> or syntax check</span><span class="strut">&nbsp;</span></p>
<p id="t126" class="stm mis">                                    <span class="nam">play</span><span class="op">.</span><span class="nam">vars</span><span class="op">[</span><span class="nam">vname</span><span class="op">]</span> <span class="op">=</span> <span class="nam">default</span><span class="strut">&nbsp;</span></p>
<p id="t127" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t128" class="pln">                    <span class="com"># Post validate so any play level variables are templated</span><span class="strut">&nbsp;</span></p>
<p id="t129" class="stm run hide_run">                    <span class="nam">all_vars</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_variable_manager</span><span class="op">.</span><span class="nam">get_vars</span><span class="op">(</span><span class="nam">play</span><span class="op">=</span><span class="nam">play</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t130" class="stm run hide_run">                    <span class="nam">templar</span> <span class="op">=</span> <span class="nam">Templar</span><span class="op">(</span><span class="nam">loader</span><span class="op">=</span><span class="nam">self</span><span class="op">.</span><span class="nam">_loader</span><span class="op">,</span> <span class="nam">variables</span><span class="op">=</span><span class="nam">all_vars</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t131" class="stm run hide_run">                    <span class="nam">play</span><span class="op">.</span><span class="nam">post_validate</span><span class="op">(</span><span class="nam">templar</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t132" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t133" class="stm par run hide_run"><span class="annotate short">133&#x202F;&#x219B;&#x202F;134</span><span class="annotate long">line 133 didn't jump to line 134, because the condition on line 133 was never true</span>                    <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_options</span><span class="op">.</span><span class="nam">syntax</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t134" class="stm mis">                        <span class="key">continue</span><span class="strut">&nbsp;</span></p>
<p id="t135" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t136" class="stm par run hide_run"><span class="annotate short">136&#x202F;&#x219B;&#x202F;138</span><span class="annotate long">line 136 didn't jump to line 138, because the condition on line 136 was never true</span>                    <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span> <span class="key">is</span> <span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t137" class="pln">                        <span class="com"># we are just doing a listing</span><span class="strut">&nbsp;</span></p>
<p id="t138" class="stm mis">                        <span class="nam">entry</span><span class="op">[</span><span class="str">'plays'</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">play</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t139" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t140" class="pln">                    <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t141" class="stm run hide_run">                        <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">_unreachable_hosts</span><span class="op">.</span><span class="nam">update</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_unreachable_hosts</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t142" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t143" class="stm run hide_run">                        <span class="nam">previously_failed</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">_failed_hosts</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t144" class="stm run hide_run">                        <span class="nam">previously_unreachable</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">_unreachable_hosts</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t145" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t146" class="stm run hide_run">                        <span class="nam">break_play</span> <span class="op">=</span> <span class="nam">False</span><span class="strut">&nbsp;</span></p>
<p id="t147" class="pln">                        <span class="com"># we are actually running plays</span><span class="strut">&nbsp;</span></p>
<p id="t148" class="stm run hide_run">                        <span class="nam">batches</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_get_serialized_batches</span><span class="op">(</span><span class="nam">play</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t149" class="stm par run hide_run"><span class="annotate short">149&#x202F;&#x219B;&#x202F;150</span><span class="annotate long">line 149 didn't jump to line 150, because the condition on line 149 was never true</span>                        <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">batches</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t150" class="stm mis">                            <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">send_callback</span><span class="op">(</span><span class="str">'v2_playbook_on_play_start'</span><span class="op">,</span> <span class="nam">play</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t151" class="stm mis">                            <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">send_callback</span><span class="op">(</span><span class="str">'v2_playbook_on_no_hosts_matched'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t152" class="stm run hide_run">                        <span class="key">for</span> <span class="nam">batch</span> <span class="key">in</span> <span class="nam">batches</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t153" class="pln">                            <span class="com"># restrict the inventory to the hosts in the serialized batch</span><span class="strut">&nbsp;</span></p>
<p id="t154" class="stm run hide_run">                            <span class="nam">self</span><span class="op">.</span><span class="nam">_inventory</span><span class="op">.</span><span class="nam">restrict_to_hosts</span><span class="op">(</span><span class="nam">batch</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t155" class="pln">                            <span class="com"># and run it...</span><span class="strut">&nbsp;</span></p>
<p id="t156" class="stm run hide_run">                            <span class="nam">result</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">run</span><span class="op">(</span><span class="nam">play</span><span class="op">=</span><span class="nam">play</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t157" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t158" class="pln">                            <span class="com"># break the play if the result equals the special return code</span><span class="strut">&nbsp;</span></p>
<p id="t159" class="stm par run hide_run"><span class="annotate short">159&#x202F;&#x219B;&#x202F;160</span><span class="annotate long">line 159 didn't jump to line 160, because the condition on line 159 was never true</span>                            <span class="key">if</span> <span class="nam">result</span> <span class="op">&amp;</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">RUN_FAILED_BREAK_PLAY</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t160" class="stm mis">                                <span class="nam">result</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">RUN_FAILED_HOSTS</span><span class="strut">&nbsp;</span></p>
<p id="t161" class="stm mis">                                <span class="nam">break_play</span> <span class="op">=</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t162" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t163" class="pln">                            <span class="com"># check the number of failures here, to see if they're above the maximum</span><span class="strut">&nbsp;</span></p>
<p id="t164" class="pln">                            <span class="com"># failure percentage allowed, or if any errors are fatal. If either of those</span><span class="strut">&nbsp;</span></p>
<p id="t165" class="pln">                            <span class="com"># conditions are met, we break out, otherwise we only break out if the entire</span><span class="strut">&nbsp;</span></p>
<p id="t166" class="pln">                            <span class="com"># batch failed</span><span class="strut">&nbsp;</span></p>
<p id="t167" class="stm run hide_run">                            <span class="nam">failed_hosts_count</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">_failed_hosts</span><span class="op">)</span> <span class="op">+</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">_unreachable_hosts</span><span class="op">)</span> <span class="op">-</span> <span class="xx">\</span><span class="strut">&nbsp;</span></p>
<p id="t168" class="pln">                                <span class="op">(</span><span class="nam">previously_failed</span> <span class="op">+</span> <span class="nam">previously_unreachable</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t169" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t170" class="stm run hide_run">                            <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">batch</span><span class="op">)</span> <span class="op">==</span> <span class="nam">failed_hosts_count</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t171" class="stm run hide_run">                                <span class="nam">break_play</span> <span class="op">=</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t172" class="stm run hide_run">                                <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t173" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t174" class="pln">                            <span class="com"># update the previous counts so they don't accumulate incorrectly</span><span class="strut">&nbsp;</span></p>
<p id="t175" class="pln">                            <span class="com"># over multiple serial batches</span><span class="strut">&nbsp;</span></p>
<p id="t176" class="stm run hide_run">                            <span class="nam">previously_failed</span> <span class="op">+=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">_failed_hosts</span><span class="op">)</span> <span class="op">-</span> <span class="nam">previously_failed</span><span class="strut">&nbsp;</span></p>
<p id="t177" class="stm run hide_run">                            <span class="nam">previously_unreachable</span> <span class="op">+=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">_unreachable_hosts</span><span class="op">)</span> <span class="op">-</span> <span class="nam">previously_unreachable</span><span class="strut">&nbsp;</span></p>
<p id="t178" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t179" class="pln">                            <span class="com"># save the unreachable hosts from this batch</span><span class="strut">&nbsp;</span></p>
<p id="t180" class="stm run hide_run">                            <span class="nam">self</span><span class="op">.</span><span class="nam">_unreachable_hosts</span><span class="op">.</span><span class="nam">update</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">_unreachable_hosts</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t181" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t182" class="stm run hide_run">                        <span class="key">if</span> <span class="nam">break_play</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t183" class="stm run hide_run">                            <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t184" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t185" class="stm run hide_run">                    <span class="nam">i</span> <span class="op">=</span> <span class="nam">i</span> <span class="op">+</span> <span class="num">1</span>  <span class="com"># per play</span><span class="strut">&nbsp;</span></p>
<p id="t186" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t187" class="stm par run hide_run"><span class="annotate short">187&#x202F;&#x219B;&#x202F;188</span><span class="annotate long">line 187 didn't jump to line 188, because the condition on line 187 was never true</span>                <span class="key">if</span> <span class="nam">entry</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t188" class="stm mis">                    <span class="nam">entrylist</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">entry</span><span class="op">)</span>  <span class="com"># per playbook</span><span class="strut">&nbsp;</span></p>
<p id="t189" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t190" class="pln">                <span class="com"># send the stats callback for this playbook</span><span class="strut">&nbsp;</span></p>
<p id="t191" class="stm par run hide_run"><span class="annotate short">191&#x202F;&#x219B;&#x202F;212</span><span class="annotate long">line 191 didn't jump to line 212, because the condition on line 191 was never false</span>                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span> <span class="key">is</span> <span class="key">not</span> <span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t192" class="stm par run hide_run"><span class="annotate short">192&#x202F;&#x219B;&#x202F;193</span><span class="annotate long">line 192 didn't jump to line 193, because the condition on line 192 was never true</span>                    <span class="key">if</span> <span class="nam">C</span><span class="op">.</span><span class="nam">RETRY_FILES_ENABLED</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t193" class="stm mis">                        <span class="nam">retries</span> <span class="op">=</span> <span class="nam">set</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">_failed_hosts</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t194" class="stm mis">                        <span class="nam">retries</span><span class="op">.</span><span class="nam">update</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">_unreachable_hosts</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t195" class="stm mis">                        <span class="nam">retries</span> <span class="op">=</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">retries</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t196" class="stm mis">                        <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">retries</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t197" class="stm mis">                            <span class="key">if</span> <span class="nam">C</span><span class="op">.</span><span class="nam">RETRY_FILES_SAVE_PATH</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t198" class="stm mis">                                <span class="nam">basedir</span> <span class="op">=</span> <span class="nam">C</span><span class="op">.</span><span class="nam">RETRY_FILES_SAVE_PATH</span><span class="strut">&nbsp;</span></p>
<p id="t199" class="stm mis">                            <span class="key">elif</span> <span class="nam">playbook_path</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t200" class="stm mis">                                <span class="nam">basedir</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">dirname</span><span class="op">(</span><span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">abspath</span><span class="op">(</span><span class="nam">playbook_path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t201" class="pln">                            <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t202" class="stm mis">                                <span class="nam">basedir</span> <span class="op">=</span> <span class="str">'~/'</span><span class="strut">&nbsp;</span></p>
<p id="t203" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t204" class="stm mis">                            <span class="op">(</span><span class="nam">retry_name</span><span class="op">,</span> <span class="nam">_</span><span class="op">)</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">basename</span><span class="op">(</span><span class="nam">playbook_path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t205" class="stm mis">                            <span class="nam">filename</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">basedir</span><span class="op">,</span> <span class="str">"%s.retry"</span> <span class="op">%</span> <span class="nam">retry_name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t206" class="stm mis">                            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_generate_retry_inventory</span><span class="op">(</span><span class="nam">filename</span><span class="op">,</span> <span class="nam">retries</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t207" class="stm mis">                                <span class="nam">display</span><span class="op">.</span><span class="nam">display</span><span class="op">(</span><span class="str">"\tto retry, use: --limit @%s\n"</span> <span class="op">%</span> <span class="nam">filename</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t208" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t209" class="stm run hide_run">                    <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">send_callback</span><span class="op">(</span><span class="str">'v2_playbook_on_stats'</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">_stats</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t210" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t211" class="pln">                <span class="com"># if the last result wasn't zero, break out of the playbook file name loop</span><span class="strut">&nbsp;</span></p>
<p id="t212" class="stm run hide_run">                <span class="key">if</span> <span class="nam">result</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t213" class="stm run hide_run">                    <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t214" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t215" class="stm par run hide_run"><span class="annotate short">215&#x202F;&#x219B;&#x202F;216</span><span class="annotate long">line 215 didn't jump to line 216, because the condition on line 215 was never true</span>            <span class="key">if</span> <span class="nam">entrylist</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t216" class="stm mis">                <span class="key">return</span> <span class="nam">entrylist</span><span class="strut">&nbsp;</span></p>
<p id="t217" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t218" class="pln">        <span class="key">finally</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t219" class="stm par run hide_run"><span class="annotate short">219&#x202F;&#x219B;&#x202F;221</span><span class="annotate long">line 219 didn't jump to line 221, because the condition on line 219 was never false</span>            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span> <span class="key">is</span> <span class="key">not</span> <span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t220" class="stm run hide_run">                <span class="nam">self</span><span class="op">.</span><span class="nam">_tqm</span><span class="op">.</span><span class="nam">cleanup</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t221" class="stm par run hide_run"><span class="annotate short">221&#x202F;&#x219B;&#x202F;exit,&nbsp;&nbsp; 221&#x202F;&#x219B;&#x202F;224</span><span class="annotate long">2 missed branches: 1) line 221 didn't return from function 'run', because the return on line 216 wasn't executed, 2) line 221 didn't jump to line 224, because the condition on line 221 was never false</span>            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_loader</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t222" class="stm par run hide_run"><span class="annotate short">222&#x202F;&#x219B;&#x202F;exit</span><span class="annotate long">line 222 didn't return from function 'run', because the return on line 216 wasn't executed</span>                <span class="nam">self</span><span class="op">.</span><span class="nam">_loader</span><span class="op">.</span><span class="nam">cleanup_all_tmp_files</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t223" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t224" class="stm par run hide_run"><span class="annotate short">224&#x202F;&#x219B;&#x202F;225</span><span class="annotate long">line 224 didn't jump to line 225, because the condition on line 224 was never true</span>        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_options</span><span class="op">.</span><span class="nam">syntax</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t225" class="stm mis">            <span class="nam">display</span><span class="op">.</span><span class="nam">display</span><span class="op">(</span><span class="str">"No issues encountered"</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t226" class="stm mis">            <span class="key">return</span> <span class="nam">result</span><span class="strut">&nbsp;</span></p>
<p id="t227" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t228" class="stm run hide_run">        <span class="key">return</span> <span class="nam">result</span><span class="strut">&nbsp;</span></p>
<p id="t229" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t230" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_get_serialized_batches</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">play</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t231" class="pln">        <span class="str">'''</span><span class="strut">&nbsp;</span></p>
<p id="t232" class="pln"><span class="str">        Returns a list of hosts, subdivided into batches based on</span><span class="strut">&nbsp;</span></p>
<p id="t233" class="pln"><span class="str">        the serial size specified in the play.</span><span class="strut">&nbsp;</span></p>
<p id="t234" class="pln"><span class="str">        '''</span><span class="strut">&nbsp;</span></p>
<p id="t235" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t236" class="pln">        <span class="com"># make sure we have a unique list of hosts</span><span class="strut">&nbsp;</span></p>
<p id="t237" class="stm run hide_run">        <span class="nam">all_hosts</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_inventory</span><span class="op">.</span><span class="nam">get_hosts</span><span class="op">(</span><span class="nam">play</span><span class="op">.</span><span class="nam">hosts</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t238" class="stm run hide_run">        <span class="nam">all_hosts_len</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">all_hosts</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t239" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t240" class="pln">        <span class="com"># the serial value can be listed as a scalar or a list of</span><span class="strut">&nbsp;</span></p>
<p id="t241" class="pln">        <span class="com"># scalars, so we make sure it's a list here</span><span class="strut">&nbsp;</span></p>
<p id="t242" class="stm run hide_run">        <span class="nam">serial_batch_list</span> <span class="op">=</span> <span class="nam">play</span><span class="op">.</span><span class="nam">serial</span><span class="strut">&nbsp;</span></p>
<p id="t243" class="stm par run hide_run"><span class="annotate short">243&#x202F;&#x219B;&#x202F;246</span><span class="annotate long">line 243 didn't jump to line 246, because the condition on line 243 was never false</span>        <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">serial_batch_list</span><span class="op">)</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t244" class="stm run hide_run">            <span class="nam">serial_batch_list</span> <span class="op">=</span> <span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t245" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t246" class="stm run hide_run">        <span class="nam">cur_item</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t247" class="stm run hide_run">        <span class="nam">serialized_batches</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t248" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t249" class="stm par run hide_run"><span class="annotate short">249&#x202F;&#x219B;&#x202F;274</span><span class="annotate long">line 249 didn't jump to line 274, because the condition on line 249 was never false</span>        <span class="key">while</span> <span class="nam">len</span><span class="op">(</span><span class="nam">all_hosts</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t250" class="pln">            <span class="com"># get the serial value from current item in the list</span><span class="strut">&nbsp;</span></p>
<p id="t251" class="stm run hide_run">            <span class="nam">serial</span> <span class="op">=</span> <span class="nam">pct_to_int</span><span class="op">(</span><span class="nam">serial_batch_list</span><span class="op">[</span><span class="nam">cur_item</span><span class="op">]</span><span class="op">,</span> <span class="nam">all_hosts_len</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t252" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t253" class="pln">            <span class="com"># if the serial count was not specified or is invalid, default to</span><span class="strut">&nbsp;</span></p>
<p id="t254" class="pln">            <span class="com"># a list of all hosts, otherwise grab a chunk of the hosts equal</span><span class="strut">&nbsp;</span></p>
<p id="t255" class="pln">            <span class="com"># to the current serial item size</span><span class="strut">&nbsp;</span></p>
<p id="t256" class="stm par run hide_run"><span class="annotate short">256&#x202F;&#x219B;&#x202F;260</span><span class="annotate long">line 256 didn't jump to line 260, because the condition on line 256 was never false</span>            <span class="key">if</span> <span class="nam">serial</span> <span class="op">&lt;=</span> <span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t257" class="stm run hide_run">                <span class="nam">serialized_batches</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">all_hosts</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t258" class="stm run hide_run">                <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t259" class="pln">            <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t260" class="stm mis">                <span class="nam">play_hosts</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t261" class="stm mis">                <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">serial</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t262" class="stm mis">                    <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">all_hosts</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t263" class="stm mis">                        <span class="nam">play_hosts</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">all_hosts</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t264" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t265" class="stm mis">                <span class="nam">serialized_batches</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">play_hosts</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t266" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t267" class="pln">            <span class="com"># increment the current batch list item number, and if we've hit</span><span class="strut">&nbsp;</span></p>
<p id="t268" class="pln">            <span class="com"># the end keep using the last element until we've consumed all of</span><span class="strut">&nbsp;</span></p>
<p id="t269" class="pln">            <span class="com"># the hosts in the inventory</span><span class="strut">&nbsp;</span></p>
<p id="t270" class="stm mis">            <span class="nam">cur_item</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t271" class="stm mis">            <span class="key">if</span> <span class="nam">cur_item</span> <span class="op">></span> <span class="nam">len</span><span class="op">(</span><span class="nam">serial_batch_list</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t272" class="stm mis">                <span class="nam">cur_item</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">serial_batch_list</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t273" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t274" class="stm run hide_run">        <span class="key">return</span> <span class="nam">serialized_batches</span><span class="strut">&nbsp;</span></p>
<p id="t275" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t276" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_generate_retry_inventory</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">retry_path</span><span class="op">,</span> <span class="nam">replay_hosts</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t277" class="pln">        <span class="str">'''</span><span class="strut">&nbsp;</span></p>
<p id="t278" class="pln"><span class="str">        Called when a playbook run fails. It generates an inventory which allows</span><span class="strut">&nbsp;</span></p>
<p id="t279" class="pln"><span class="str">        re-running on ONLY the failed hosts.  This may duplicate some variable</span><span class="strut">&nbsp;</span></p>
<p id="t280" class="pln"><span class="str">        information in group_vars/host_vars but that is ok, and expected.</span><span class="strut">&nbsp;</span></p>
<p id="t281" class="pln"><span class="str">        '''</span><span class="strut">&nbsp;</span></p>
<p id="t282" class="stm mis">        <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t283" class="stm mis">            <span class="nam">makedirs_safe</span><span class="op">(</span><span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">dirname</span><span class="op">(</span><span class="nam">retry_path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t284" class="stm mis">            <span class="key">with</span> <span class="nam">open</span><span class="op">(</span><span class="nam">retry_path</span><span class="op">,</span> <span class="str">'w'</span><span class="op">)</span> <span class="key">as</span> <span class="nam">fd</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t285" class="stm mis">                <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">replay_hosts</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t286" class="stm mis">                    <span class="nam">fd</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">"%s\n"</span> <span class="op">%</span> <span class="nam">x</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t287" class="stm mis">        <span class="key">except</span> <span class="nam">Exception</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t288" class="stm mis">            <span class="nam">display</span><span class="op">.</span><span class="nam">warning</span><span class="op">(</span><span class="str">"Could not create retry file '%s'.\n\t%s"</span> <span class="op">%</span> <span class="op">(</span><span class="nam">retry_path</span><span class="op">,</span> <span class="nam">to_native</span><span class="op">(</span><span class="nam">e</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t289" class="stm mis">            <span class="key">return</span> <span class="nam">False</span><span class="strut">&nbsp;</span></p>
<p id="t290" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t291" class="stm mis">        <span class="key">return</span> <span class="nam">True</span><span class="strut">&nbsp;</span></p>

            </td>
        </tr>
    </table>
</div>

<div id="footer">
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; index</a> &nbsp; &nbsp; <a class="nav" href="https://coverage.readthedocs.io">coverage.py v4.5.2</a>,
            created at 2019-05-13 15:45
        </p>
    </div>
</div>

</body>
</html>
