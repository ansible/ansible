---
- name: install NSSM
  win_chocolatey:
    name: NSSM
    state: present

# Run actual tests
- block:
  - include_tasks: tests.yml

  always:
    - name: ensure test service is absent
      win_service:
        name: '{{ test_service_name }}'
        state: absent

    - name: uninstall NSSM
      win_chocolatey:
        name: NSSM
        state: absent
      failed_when: false
