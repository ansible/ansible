- name: Install flatpak on Fedora
  dnf:
    name: flatpak
    state: present
  become: true
  when: ansible_distribution == 'Fedora'

- block:
  - name: Activate flatpak ppa on Ubuntu versions older than 18.04/bionic
    apt_repository:
      repo: "ppa:alexlarsson/flatpak"
      state: present
      mode: 0644
    when: ansible_lsb.major_release | int < 18

  - name: Install flatpak package on Ubuntu
    apt:
      name: flatpak
      state: present

  when: ansible_distribution == 'Ubuntu'

- name: Install dummy remote for user
  flatpak_remote:
    name: dummy-remote
    state: present
    flatpakrepo_url: /tmp/flatpak/repo/dummy-repo.flatpakrepo
    method: user

- name: Install dummy remote for system
  flatpak_remote:
    name: dummy-remote
    state: present
    flatpakrepo_url: /tmp/flatpak/repo/dummy-repo.flatpakrepo
    method: system

- name: Add flatpak for testing check mode on present flatpak
  flatpak:
    name: com.dummy.App8
    remote: dummy-remote
    no_dependencies: true
    state: present
