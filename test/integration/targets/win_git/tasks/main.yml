---
- name: Determine if server has git.exe installed
  win_command: get-command git.exe
  register: git_client
  ignore_errors: yes

# - name: Fail when git is not installed
#   win_git:
#     repo: https://github.com/ansible/ansible-examples.git
#   register: git_fail  
#   failed_when: '"git.exe is not installed" in git_fail.git_msg' 

- name: Install git if not installed
  win_chocolatey:
    name: git
    version: 2.20.0
  when: git_client.rc !=  0 

- name: Create a temp directory
  win_file:
    name: "{{ temp_path }}"
    state: directory

- block:
  - name: run tests
    include_tasks: test.yml