- name: Nominal behavior
  module_behavior:
  register: nominal_behavior

- name: Missing stdout
  module_behavior:
    stdout: ''
  register: missing_stdout
  ignore_errors: true

- name: non-zero rc
  module_behavior:
    rc: 2
  register: non_zero_rc
  ignore_errors: true

- name: traceback
  module_behavior:
    traceback: true
  register: traceback
  ignore_errors: true

- name: behavior assertions
  assert:
    that:
      - nominal_behavior is successful
      - nominal_behavior.msg == 'Hello, World!'

      - missing_stdout is failed
      - missing_stdout.msg.splitlines()|first == empty_stdout

      - non_zero_rc is successful
      - non_zero_rc.warnings is defined
      - non_zero_rc.warnings|select('search', 'exited with a non-zero rc') != []
      # - non_zero_rc.module_rc == 2
      # - non_zero_rc.module_stdout is defined
      # - non_zero_rc.module_stderr is defined

      - traceback is failed
      - traceback.module_rc is not defined
  vars:
    empty_stdout: The module returned an empty response to stdout but exited with rc=0, this may indicate a misbehaving module.
