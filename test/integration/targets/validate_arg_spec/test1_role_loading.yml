---
- name: "Running role test1"
  hosts: localhost
  gather_facts: false
  roles:
    - role: 'test1'
      vars:
        test1_var2: 'THE_TEST1_VAR2_PLAY_ROLES_VARS_VALUE'
        tidy_path: "/tmp/tidy-stuff"
      allow_duplicates: true
        # - "{{ tidy_survey_vars.vars|default(omit) }}"
  vars:
    test1_survey_vars_include:
      role: "test1"
      name: "test1"
      tidy_path: "/tmp/tidy-stuff"
      test1_var2: 'THE_TEST1_VAR2_PLAY_LEVEL_VARS_FOR_INCLUDE_VALUE'
      vars:
        tidy_path: "/tmp/tidy-stuff"
        test1_var2: 'THE_TEST1_VAR2_PLAY_LEVEL_VARS_FOR_INCLUDE_VALUE'
    test1_survey_vars_import:
      role: "test1"
      name: "test1"
      tidy_path: "/tmp/tidy-stuff"
      test1_var2: 'THE_TEST1_VAR2_PLAY_LEVEL_VARS_FOR_IMPORT_VALUE'
  tasks:
    - name: include_role test1_survey_vars_include
      include_role:
        name: "{{ test1_survey_vars_include.name|default(omit) }}"
        allow_duplicates: true
      tags: ["include1"]
    - name: include_role test1_survey_vars_include with vars line by line tidy-001
      include_role:
        name: "test1"
      vars:
        test1_var2: "{{ test1_survey_vars_include.test1_var2|default(omit) }}"
        tidy_path: "/tmp/tidy-001"
        #    - include_role: "{{ test1_survey_vars_include.vars|default(omit) }}"
      tags: ["include2"]
    - name: include_role test1_survey_vars_include with hardcoded vars line by line tidy-003 test1_var2 in vars
      include_role:
        name: "test1"
      vars:
        test1_var2: "THE_TEST1_VAR2_HARDCODED_IN_INCLUDE_ROLE_VARS_FOR_INCLUDE_VALUE"
        tidy_path: "/tmp/tidy-001"
        #    - include_role: "{{ test1_survey_vars_include.vars|default(omit) }}"
      tags: ["include3"]
    - name: import_role test1_survey_vars_import tidy-002
      import_role:
        name: "{{ test1_survey_vars_import.name|default(omit) }}"
        allow_duplicates: true
      vars:
        test1_var2: "{{ test1_survey_vars_import.test1_var2|default(omit) }}"
        tidy_path: "/tmp/tidy-002"
        # vars: "{{ test1_survey_vars_import.vars|default(omit) }}"
      tags: ["import1"]
#    - name: import_role attempt using vars pointing at a var
#      import_role:
#        name: "{{ test1_survey_vars_import.name|default(omit) }}"
#        allow_duplicates: true
#      vars: "{{ test1_survey_vars_import.vars|default(omit) }}"
