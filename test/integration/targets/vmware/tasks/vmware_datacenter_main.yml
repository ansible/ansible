# Test code for the vmware_datacenter module.
# Copyright: (c) 2017, Abhijeet Kasurde <akasurde@redhat.com>
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

# Testcase 0001: Add Datacenter
- &add_dc
  name: add datacenter
  vmware_datacenter:
    validate_certs: False
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    datacenter_name: datacenter_0001
    state: present
  register: dc_result

- debug:
    var: dc_result
- name: ensure datacenter is present
  assert:
    that:
        - "{{ dc_result.changed == true }}"

# Testcase 0002: Try to add same datacenter
- <<: *add_dc
  name: add datacenter again to check idempotent behavior

- name: ensure datacenter status is not changed
  assert:
    that:
        - "{{ dc_result.changed == false }}"

- when: vcsim is not defined
  block:
  - name: add datacenter
    vmware_datacenter:
      validate_certs: False
      hostname: "{{ vcenter_hostname }}"
      username: "{{ vcenter_username }}"
      password: "{{ vcenter_password }}"
      datacenter_name: datacenter_0001
      state: absent
    register: dc_result_delete
  
  - name: ensure datacenter is absent
    assert:
      that:
        - "{{ dc_result_delete.changed == true }}"
